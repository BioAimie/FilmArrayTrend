a <- turn(runs.reg.date, 'CustomerSiteId', '25', 'RP', calendar.df, 10)
plot(x=a$Panels, y=a$SpecRuns)
head(a)
plot(x=a$SpecPositives, y=a$SpecRuns)
ggplot(a, aes(x=YearWeek, y=SpecRuns/SpecPositives, group=1)) + geom_line()
head9a
head(a)
head(a)
lm(SpecRuns~Instruments, data=a)
lm(SpecRuns~Instruments, data=a[1:52, ])
attributes(lm(SpecRuns~Instruments, data=a[1:52, ]))
attributes(lm(SpecRuns~Instruments, data=a[1:52, ]))
attributes(summary(lm(SpecRuns~Instruments, data=a[1:52, ])))
summary(lm(SpecRuns~Instruments, data=a[1:52, ]))$r.squared
summary(lm(SpecRuns~Instruments, data=a[4:56, ]))$r.squared
summary(lm(SpecRuns~Instruments, data=a[20:76, ]))$r.squared
head(a)
head(a)
lm(SpecRuns~Runs+Instruments+Panels+SpecPositives, data=a[1:52, ])
summary(lm(SpecRuns~Runs+Instruments+Panels+SpecPositives, data=a[1:52, ]))$r.squared
summary(lm(SpecRuns~Instruments+Panels+SpecPositives, data=a[1:52, ]))$r.squared
summary(lm(SpecRuns~Instruments+Panels+SpecPositives, data=a[1:52, ]))$r.squared
summary(lm(SpecRuns~Instruments+Panels+SpecPositives, data=a[200:252, ]))$r.squared
View(a)
summary(lm(SpecRuns~Instruments+Panels+SpecPositives, data=a[150:202, ]))$r.squared
a[150:202, ]
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
# load custom functions
source('../Rfunctions/TURN.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
ggplot(runs.reg.date, aes(x=YearWeek, y=Run, fill=Panel)) + geom_bar(stat='identity') + facet_wrap(~CustomerSiteId, scale='free_y')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
a <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
head(a)
average(a[length(a$YearWeek):(length(a$YearWeek)-52), 'SpecRuns'])
mean(a[length(a$YearWeek):(length(a$YearWeek)-52), 'SpecRuns'])
mean(a[length(a$YearWeek):(length(a$YearWeek)-52), 'SpecRuns'])/3
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
class(a$YearWeek)
head(a)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
View(b)
227-52
ggplot(b, aes(x=YearWeek, y=SpecRuns/SpecMed)) + geom_bar(stat='identity')
ggplot(b, aes(x=YearWeek, y=Instruments/InstMed)) + geom_bar(stat='identity')
lm(SpecRuns~Instruments+Panels, data=b)
summary(lm(SpecRuns~Instruments+Panels, data=b))
head(b)
summary(lm(SpecRuns~Instruments+Panels, data=b))
attributes(summary(lm(SpecRuns~Instruments+Panels, data=b)))
summary(lm(SpecRuns~Instruments+Panels, data=b))$r.squared
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
View(b)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
View(b)
ggplot(b, aes(x=YearWeek, y=PanelPositivesPerInst)) + geom_bar(stat='identity')
ggplot(b, aes(x=YearWeek, y=(SpecRuns/SpecMed)/InstMed)) + geom_bar(stat='identity')
head(b)
head(a)
lm(SpecRuns~Runs, data=a)
attrributes(summary(lm(SpecRuns~Runs, data=a)))
attributes(summary(lm(SpecRuns~Runs, data=a)))
summary(lm(SpecRuns~Runs, data=a))$coefficients
summary(lm(SpecRuns~Runs, data=a))$coefficients[[1]]
summary(lm(SpecRuns~Runs, data=a))$coefficients[[2]]
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', 25, 'RP', calendar.df, 10)
head(b)
ggplot(b, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*(SpecRuns*InstCo/Days/Instruments)) + geom_bar(stat='identity')
ggplot(b, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*(SpecRuns*InstCo/Days/Instruments))) + geom_bar(stat='identity')
head(b)
ggplot(b, aes(x=YearWeek,  y=InstCo, group='coeff')) + geom_point()
ggplot(b, aes(x=YearWeek,  y=SpecRuns/Days/InstCo, group='coeff')) + geom_point()
ggplot(b, aes(x=YearWeek,  y=((SpecRuns/Days/InstCo)*InstR2 + (1-InstR2)*SpecRuns/Days), group='coeff')) + geom_point()
View(b)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', '2', 'RP', calendar.df, 30)
sites <- as.character(unique(runs.reg.date$CustomerSiteId))
do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
warning()
warnings()
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
turn(runs.reg.date, 'CustomerSiteId', '2', 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
sites
turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[5], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[7], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[9], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[10], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[11], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[12], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[13], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[14], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
sites
turn(runs.reg.date, 'CustomerSiteId', sites[16], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[17], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[18], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[18], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[19], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[20], 'RP', calendar.df, 30)
sites
length(sites)
d <- do.call(rbind, lapply(1:(length(sites)-2), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
warnings()
d <- turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
rm(c)
c('hello','friend')
head(d)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
head(d)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
head(d)
head(d)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
d <- turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(d)
head(d)
ggplot(d, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*SpecRuns/Days/InstCo)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
ggplot(d, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*SpecRuns/Days/Instruments)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
ggplot(d, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*SpecRuns/InstCo)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
ggplot(d, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/Days + InstR2*SpecRuns/Days*InstCo)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
heada(d)
head(d)
ggplot(d, aes(x=YearWeek, y=(1-InstR2)*SpecRuns/SpecMed/Days + InstR2*SpecRuns/SpecMed/Days/InstMed)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
View(b)
ggplot(d, aes(x=YearWeek, y=((1-InstR2)*SpecRuns/SpecMed/Days + InstR2*SpecRuns/SpecMed/Days/InstMed + SpecRuns/Runs*PansMed/Days))) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
head(b)
ggplot(runs.reg.date, aes(x=YearWeek, y=Runs)) + geom_bar(stat='identity') + facet_wrap(~CustomerSiteId, scale='free_y')
head(runs.reg.date)
ggplot(runs.reg.date, aes(x=YearWeek, y=Run)) + geom_bar(stat='identity') + facet_wrap(~CustomerSiteId, scale='free_y')
head(b)
head(d)
head(d)
ggplot(d, aes(x=YearWeek, y=SpecRuns/Days/SpecMed)) + geom_point() + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=SpecRuns/SpecMed)) + geom_point() + facet_wrap(~CustomerSiteId)
head(d)
head(d)
head(b)
plot(x=b$Instruments, y=b$SpecRuns)
plot(x=b$Runs, y=b$SpecRuns)
plot(x=b$Panels, y=b$SpecRuns)
woth(d[d$CustomerSiteId==2, ], plot(x=Runs, y=SpecRuns))
with(d[d$CustomerSiteId==2, ], plot(x=Runs, y=SpecRuns))
with(d[d$CustomerSiteId==7, ], plot(x=Runs, y=SpecRuns))
with(d[d$CustomerSiteId==9, ], plot(x=Runs, y=SpecRuns))
with(d[d$CustomerSiteId==26, ], plot(x=Runs, y=SpecRuns))
with(d[d$CustomerSiteId==26, ], plot(x=Runs, y=SpecRuns))
ggplot(d, aes(x=Runs, y=SpecRuns)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free')
head(d)
head(runs.reg.date)
lm(SpecRuns~Runs, data = d[d$CustomerSiteId==7, ])
summary(lm(SpecRuns~Runs, data = d[d$CustomerSiteId==7, ]))
summary(lm(SpecRuns~Runs, data = d[d$CustomerSiteId==29, ]))
summary(lm(SpecRuns~Runs, data = d[d$CustomerSiteId==5, ]))
ggplot(d, aes(x=Instruments, y=SpecRuns)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free')
ggplot(d, aes(x=Panels, y=SpecRuns)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free')
head(d)
ggplot(d, aes(x=YearWeek, y=PanelRunsPerDay/Instruments)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free')
head(d)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(d)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(d)
head(d)
ggplot(d, aes(x=YearWeek, y=(1-InstR2-PansR2)*SpecRunsPerDay + InstR2*SpecRunsPerDayPerInst + PansR2*SpecRunsPerDayPerInstPerPanel)) + geom_point() + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=(1-InstR2-PansR2)*SpecRunsPerDay + InstR2*SpecRunsPerDayPerInst + PansR2*SpecRunsPerDayPerInstPerPanel)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
ggplot(d, aes(x=YearWeek, y=SpecRunsPerDay/SpecMed + InstR2*SpecRunsPerDayPerInst + PansR2*SpecRunsPerDayPerInstPerPanel)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
# load custom functions
source('../Rfunctions/TURN.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(d)
with(d, (RunsR2*SpecRuns/Days + InstR2*SpecRuns/Days/Instruments + PansR2*SpecRuns/Days/Panels)/(RunsR2+InstR2+PansR2))
d$Try1 <- with(d, (RunsR2*SpecRuns/Days + InstR2*SpecRuns/Days/Instruments + PansR2*SpecRuns/Days/Panels)/(RunsR2+InstR2+PansR2))
head(d)
ggplot(d, aes(x=YearWeek, y=Try1)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
head(d)
ggplot(d, aes(x=YearWeek, y=SpecRuns)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
d$Try2 <- with(d, (RunsR2*SpecRuns/SpecMed/Days + InstR2*SpecRuns/SpecMed/Days/Instruments + PansR2*SpecRuns/SpecMed/Days/Panels)/(RunsR2+InstR2+PansR2))
ggplot(d, aes(x=YearWeek, y=Try2)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
d$Try3 <- with(d, 30*(RunsR2*SpecRuns/SpecMed/Days + InstR2*SpecRuns/SpecMed/Days/Instruments + PansR2*SpecRuns/SpecMed/Days/Panels)/(RunsR2+InstR2+PansR2))
ggplot(d, aes(x=YearWeek, y=Try3)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
head(d)
head(d)
f <- with(d, aggregate(Try3~YearWeek, FUN=mean))
head(f)
ggplot(f, aes(x=YearWeek, y=Try3, group='NatAvg')) + geom_line()
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
g <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(g)
ggplot(g, aes(x=YearWeek, y=TURN)) + geom_point() + facet_wrap(~CustomerSiteId)
head(g)
with(g, aggregate(TURN~CustomerSiteId, FUN=mean))
merge(g, with(g, aggregate(TURN~CustomerSiteId, FUN=mean)), by='CustomerSiteId')
h <- merge(g, with(g, aggregate(TURN~CustomerSiteId, FUN=mean)), by='CustomerSiteId')
head(h)
head(h)
colnames(h)[(length(colnames(h))-1):length(colnames(h))]
colnames(h)[(length(colnames(h))-1):length(colnames(h))] <- c('TURN','SiteMeanTURN')
head(h)
h$NormTurn <- h$TURN/h$SiteMeanTURN
ggplot(h, aes(x=YearWeek, y=NormTurn)) + geom_point() + facet_wrap(~CustomerSiteId)
head(f)
head(g)
heaD(h)
head(h)
rm(a, b, d, f, g, h)
a <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(a)
site.turn <- a
rm(a)
head(site.turn)
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, fun=mean))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
head(natn.turn)
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN')) + geom_line() + scale_x_discrete(breaks=natn.turn[seq(1, length(natn.turn$YearWeek), 12)])
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN')) + geom_line() + scale_x_discrete(breaks=natn.turn[seq(1, length(natn.turn$YearWeek), 12)])
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN')) + geom_line() + scale_x_discrete(breaks=natn.turn[seq(1, length(natn.turn$YearWeek), 12), 'YearWeek'])
head(runs.df)
min(runs.df$Date)
head(natn.turn)
head(site.turn)
head(runs.reg.date)
min(runs.reg.date$Date)
unique(runs.reg.date$Date)
head(calendar.df)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
a <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(a)
unique(a$YearWeek)
head(a)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
a <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(a)
unique(a$YearWeek)
head(a)
ggplot(a[a$YearWeek < '2014-01', ], aes(x=YearWeek, y=SpecRuns/Days)) + geom_point() + facet_wrap(~CustomerSiteId)
ggplot(a[as.character(a$YearWeek) < '2014-01', ], aes(x=YearWeek, y=SpecRuns/Days)) + geom_point() + facet_wrap(~CustomerSiteId)
ggplot(a[as.character(a$YearWeek) < '2014-01', ], aes(x=YearWeek, y=SpecRuns/Days)) + geom_point() + facet_wrap(~CustomerSiteId, scale='free_y')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
a <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
head(a)
a[as.character(a$YearWeek)=='2013-01', ]
a[as.character(a$YearWeek)=='2013-26', ]
a[as.character(a$YearWeek)=='2014-01', ]
b <- with(a, aggregate(TURN~YearWeek, FUN=mean))
head(b)
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN')) + geom_line() + scale_x_discrete(breaks=natn.turn[seq(1, length(natn.turn$YearWeek), 12), 'YearWeek'])
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN')) + geom_line(data=natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek'])
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line() + geom_line(data=natn.turn, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek'])
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek'])
cdc.reg.df <- data.frame(Year = cdc.reg.df$YEAR, Week = cdc.reg.df$WEEK, Region = cdc.reg.df$REGION, ILITotal = cdc.reg.df$ILITOTAL, TotalPatients = cdc.reg.df$TOTAL.PATIENTS)
cdc.reg.df$YearWeek <- with(cdc.reg.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
cdc.reg.count.df <- do.call(rbind, lapply(1:length(unique(cdc.reg.df$Region)), function(x)  data.frame(YearWeek =  cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'][2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'])-1)], Region = unique(cdc.reg.df$Region)[x], TotalPatients = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'TotalPatients'])), ILITotal = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'ILITotal'])))))
cdc.reg.df <- read.csv('../DataSources/RegionalILI.csv', header=TRUE, sep=',')
cdc.reg.df <- data.frame(Year = cdc.reg.df$YEAR, Week = cdc.reg.df$WEEK, Region = cdc.reg.df$REGION, ILITotal = cdc.reg.df$ILITOTAL, TotalPatients = cdc.reg.df$TOTAL.PATIENTS)
cdc.reg.df$YearWeek <- with(cdc.reg.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
cdc.reg.count.df <- do.call(rbind, lapply(1:length(unique(cdc.reg.df$Region)), function(x)  data.frame(YearWeek =  cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'][2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'])-1)], Region = unique(cdc.reg.df$Region)[x], TotalPatients = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'TotalPatients'])), ILITotal = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'ILITotal'])))))
head(cdc.reg.count.df)
cdc.reg.count.df$Rate <- with(cdc.reg.count.df, ILITotal/TotalPatients)
head(site.turn)
head(a)
head(cdc.reg.count.df)
head(regions.df)
head(cdc.reg.count.df)
head(runs.reg.date)
merge(unique(runs.reg.date[,c('CustomerSiteId','Region')]), cdc.reg.count.df, by='Region')
d <- merge(unique(runs.reg.date[,c('CustomerSiteId','Region')]), cdc.reg.count.df, by='Region')
View(d)
unique(d$YearWeek)
238*19
cdc.trend.rate <- merge(unique(runs.reg.date[,c('CustomerSiteId','Region')]), cdc.reg.count.df, by='Region')
rm(d)
head(cdc.trend.rate)
cdc.trend.rate.nat <- with(cdc.trend.rate, aggregate(Rate~YearWeek+Region, FUN=mean))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat, aes(x=YearWeek, y=Rate, group='ILI',color='ILI')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat, aes(x=YearWeek, y=100*Rate, group='ILI',color='ILI')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
cdc.trend.rate.nat <- with(cdc.trend.rate, aggregate(Rate~YearWeek, FUN=mean))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat, aes(x=YearWeek, y=100*Rate, group='ILI',color='ILI')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat, aes(x=YearWeek, y=80*Rate, group='ILI',color='ILI')) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat[as.character(cdc.trend.rate.nat$YearWeek) > '2013-25', ], aes(x=YearWeek, y=80*Rate, group='ILI',color='ILI'), size=1.5) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat[as.character(cdc.trend.rate.nat$YearWeek) > '2013-25', ], aes(x=YearWeek, y=70*Rate, group='ILI',color='ILI'), size=1.5) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
head(sites.turn)
head(site.turn)
head(a)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_discrete(values=c('black','blue'))
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue'))
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
a[a$TURN < 0.5, ]
head(a)
View(a)
a[a$TURN < 0.5, ]
a[!(is.na(a$TURN)) & a$TURN < 0.5, ]
a[!(is.na(a$TURN)) & a$TURN == 0.5, ]
a[!(is.na(a$TURN)) & a$TURN == 0.0, ]
a[!(is.na(a$TURN)) & a$TURN == 0.0, 'TURN'] <- NA
b <- with(a, aggregate(TURN~YearWeek, FUN=mean))
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat[as.character(cdc.trend.rate.nat$YearWeek) > '2013-25', ], aes(x=YearWeek, y=70*Rate, group='ILI',color='ILI'), size=1.5) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
# load custom functions
source('../Rfunctions/TURN.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
ggplot(b, aes(x=YearWeek, y=TURN, group='abvNationalTURN', color='abvNationalTURN')) + geom_line(size=1.5) + geom_line(data=natn.turn, size=1.5, aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN')) + geom_line(data=cdc.trend.rate.nat[as.character(cdc.trend.rate.nat$YearWeek) > '2013-25', ], aes(x=YearWeek, y=70*Rate, group='ILI',color='ILI'), size=1.5) + scale_x_discrete(breaks=b[seq(1, length(b$YearWeek), 12), 'YearWeek']) + scale_color_manual(values=c('red','black','blue'))
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(runs.reg.date)
ggplot(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$CustomerSiteId==5, ], aes(x=YearWeek, y=Run, fill=SerialNo)) + geom_bar(stat='identity')
ggplot(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$CustomerSiteId==31, ], aes(x=YearWeek, y=Run, fill=SerialNo)) + geom_bar(stat='identity')
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
site.turn.adj <- site.turn
site.turn.adj[!(is.na(site.turn.adj$TURN)) & site.turn.adj$TURN==0.0, 'TURN'] <- NA
natn.turn.adj <- with(site.turn.adj, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn.adj, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn.adj, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
d[!(is.na(d$TURN)) & d$TURN == 0.0, 'TURN'] <- NA
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
head(f)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
head(f)
head(f)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5)
head(d)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5)
dev.off()
ggplot(site.turn.adj, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn.adj, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
d[d$CustomerSiteId==5, ]
s <- d[d$CustomerSiteId==5, ]
View(s)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[5], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
fit <- turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
summary(fit)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
rm(fit)
t <- turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
head(d)
head(t)
head(t)
lm(SpecRuns~Runs, data=t)
summary(lm(SpecRuns~Runs, data=t))
summary(lm(SpecRuns~Runs, data=t))$r.squared
head(t)
t[t$Gap==1, ]
t[t$Gap==0, ]
median(t[t$Gap==0, 'Runs'])
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[``], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[5], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[7], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[9], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[10], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[11], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[12], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[13], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[14], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
t <- turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
head(t)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
summary(turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30))
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + facet_wrap(~CustomerSiteId, scale='free_y')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
head(d)
f
View(d)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
f
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(site.turn.adj, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn.adj, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=1.1*TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=0.9*TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN)
attributes(smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN))
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = FALSE)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = TRUE)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = TRUE)$y
f$TURN
f <- data.frame(f, Splined = smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv=FALSE)$y)
head(f)
ggplot(f, aes(x=YearWeek, y=Splined, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=Splined, group='v3', color='v3')) + geom_line(size=1.5)
