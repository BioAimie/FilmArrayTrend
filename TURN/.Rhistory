head(d)
head(f)
head(f)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5)
head(d)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5)
dev.off()
ggplot(site.turn.adj, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn.adj, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
d[d$CustomerSiteId==5, ]
s <- d[d$CustomerSiteId==5, ]
View(s)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
head(d)
do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[5], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
fit <- turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
summary(fit)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
rm(fit)
t <- turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
head(d)
head(t)
head(t)
lm(SpecRuns~Runs, data=t)
summary(lm(SpecRuns~Runs, data=t))
summary(lm(SpecRuns~Runs, data=t))$r.squared
head(t)
t[t$Gap==1, ]
t[t$Gap==0, ]
median(t[t$Gap==0, 'Runs'])
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[``], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[3], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[5], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[6], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[7], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[9], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[10], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[11], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[12], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[13], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[14], 'RP', calendar.df, 30)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
t <- turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
head(t)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
summary(turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30))
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[15], 'RP', calendar.df, 30)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + facet_wrap(~CustomerSiteId, scale='free_y')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
head(d)
f
View(d)
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
d <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
f <- with(d, aggregate(TURN~YearWeek, FUN=mean))
f
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(site.turn.adj, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn.adj, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(a, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=b, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(d, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=f, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5)
ggplot(f, aes(x=YearWeek, y=1.1*TURN, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=0.9*TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN)
attributes(smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN))
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = FALSE)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = TRUE)$y
smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv = TRUE)$y
f$TURN
f <- data.frame(f, Splined = smooth.spline(x=seq(1, length(f$YearWeek), 1), y=f$TURN, cv=FALSE)$y)
head(f)
ggplot(f, aes(x=YearWeek, y=Splined, group='v3', color='v3')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v1', color='v1'), data=natn.turn.adj, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='v2', color='v2'), data=b, size=1.5) + scale_color_manual(values = c('black','blue','red'))
ggplot(f, aes(x=YearWeek, y=Splined, group='v3', color='v3')) + geom_line(size=1.5)
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
warnings()
head(site.turn)
site.turn[site.turn$TURNG==0, ]
o <- site.turn[site.turn$TURNG==0, ]
View(o)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
View(cdc.reg.count.df)
rm(a, b, d, f,o,s,t)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[1], 'RP', calendar.df, 30)
sites[1]
View(a)
sites
a <- turn(runs.reg.date, 'CustomerSiteId', sites[2], 'RP', calendar.df, 30)
View(a)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[4], 'RP', calendar.df, 30)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[19], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[19], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[19], 'RP', calendar.df, 30)
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
a <- turn(runs.reg.date, 'CustomerSiteId', sites[19], 'RP', calendar.df, 30)
View(a)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURNG~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId)
source('~/FilmArrayTrend/TURN/main.R', echo=TRUE)
workDir <-'~/FilmArrayTrend/TURN/'
setwd(workDir)
# load libraries
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
# load custom functions
source('../Rfunctions/TURN.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
# dual axes for ILI overlay plots
hinvert_title_grob <- function(grob){
# Swap the widths
widths <- grob$widths
grob$widths[1] <- widths[3]
grob$widths[3] <- widths[1]
grob$vp[[1]]$layout$widths[1] <- widths[3]
grob$vp[[1]]$layout$widths[3] <- widths[1]
# Fix the justification
grob$children[[1]]$hjust <- 1 - grob$children[[1]]$hjust
grob$children[[1]]$vjust <- 1 - grob$children[[1]]$vjust
grob$children[[1]]$x <- unit(1, "npc") - grob$children[[1]]$x
grob
}
# read in the data from FilmArray Data Warehouse DB (ODBC object in Windows "FA_DW" with Lindsay's credentials)
FADWcxn <- odbcConnect(dsn = 'FA_DW', uid = 'afaucett', pwd = 'ThisIsAPassword-BAD')
queryVector <- readLines('../DataSources/SQL/TURN/RunDataBySite.sql')
query <- paste(queryVector,collapse="\n")
runs.df <- sqlQuery(FADWcxn,query)
queryVector <- readLines('../DataSources/CustomerSiteIdsWithNames.sql')
query <- paste(queryVector,collapse="\n")
names.df <- sqlQuery(FADWcxn,query)
odbcClose(FADWcxn)
# read in data from PMS PROD server
PMScxn <- odbcConnect('PMS_PROD')
queryVector <- scan('../DataSources/AllSitesRegionKey.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
regions.df <- sqlQuery(PMScxn,query)
odbcClose(PMScxn)
# read in data from Excel files
cdc.reg.df <- read.csv('../DataSources/RegionalILI.csv', header=TRUE, sep=',')
# make an epi calendar
calendar.df <- transformToEpiWeeks(createCalendarLikeMicrosoft(2012, 'Week'))
calendar.df$YearWeek <- with(calendar.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
calendar.df <- calendar.df[calendar.df$YearWeek > '2012-51', ]
calendar.df$Days <- 1
# now rerun the code that is in the Publication_Update main.R file to see what the data looks like now
runs.reg <- merge(merge(runs.df, names.df[,c('CustomerSiteId','State')], by='CustomerSiteId'), data.frame(Province = regions.df$StateAbv, Region = regions.df$CensusRegionLocal), by.x='State', by.y='Province')
runs.reg.date <- merge(runs.reg, calendar.df[,c('Date','Year','Week','YearWeek')], by='Date')
# clean up the data frame that holds the cdc regional data
cdc.reg.df <- data.frame(Year = cdc.reg.df$YEAR, Week = cdc.reg.df$WEEK, Region = cdc.reg.df$REGION, ILITotal = cdc.reg.df$ILITOTAL, TotalPatients = cdc.reg.df$TOTAL.PATIENTS)
cdc.reg.df$YearWeek <- with(cdc.reg.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
cdc.reg.count.df <- do.call(rbind, lapply(1:length(unique(cdc.reg.df$Region)), function(x)  data.frame(YearWeek =  cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'][2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x], 'YearWeek'])-1)], Region = unique(cdc.reg.df$Region)[x], TotalPatients = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'TotalPatients'])), ILITotal = sapply(2:(length(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],'YearWeek'])-1), function(y) sum(cdc.reg.df[cdc.reg.df$Region == unique(cdc.reg.df$Region)[x],][(y-1):(y+1), 'ILITotal'])))))
cdc.reg.count.df$Rate <- with(cdc.reg.count.df, ILITotal/TotalPatients)
cdc.trend.rate <- merge(unique(runs.reg.date[,c('CustomerSiteId','Region')]), cdc.reg.count.df, by='Region')
cdc.trend.rate.nat <- with(cdc.trend.rate, aggregate(Rate~YearWeek, FUN=mean))
# ------------------------------------------ ANALYSIS -----------------------------------------------------------------------------
ggplot(runs.reg.date, aes(x=YearWeek, y=Run, fill=Panel)) + geom_bar(stat='identity') + facet_wrap(~CustomerSiteId, scale='free_y')
sites <- as.character(unique(runs.reg.date$CustomerSiteId))
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30))) + labs(title='TURNG')
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30))) + labs(title='TURNG')
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId) + labs(title='TURN')
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
# natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
natn.turn <- with(site.turn, aggregate(TURNG~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURNG', color='NationalTURNG'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId) + labs(title='TURNG')
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURNG', color='NationalTURNG'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURNG')
head(site.turn)
ggplot(site.turn, aes(x=YearWeek, y=SpecPositives/SpecRuns, group=CustomerSiteId)) + geom_line() + facet_wrap(~CustomerSiteId)
library(RODBC)
library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
ggplot(site.turn, aes(x=YearWeek, y=SpecPositives/SpecRuns, group=CustomerSiteId)) + geom_line() + facet_wrap(~CustomerSiteId)
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURNG', color='NationalTURNG'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURNG')
head(site.turn)
ggplot(site.turn, aes(x=YearWeek, y=SpecRuns, group='SiteRP', color='SiteRP')) + geom_line(size=1.5) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='RP Centered Runs')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId) + labs(title='TURN')
head(site.turn)
a <- site.turn[site.turn$CustomerSiteId==13, ]
View(a)
source('~/FilmArrayTrend/Rfunctions/TURN_v2.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURNG~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURNG, group='SiteTURNG', color='SiteTURNG')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURNG, group='NationalTURNG', color='NationalTURNG'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURNG')
head(site.turn)
ggplot(site.turn, aes(x=YearWeek, y=SpecPositives/SpecRuns)) + goem_point() + facet_wrap(~CustomerSiteId)
ggplot(site.turn, aes(x=YearWeek, y=SpecPositives/SpecRuns)) + geom_point() + facet_wrap(~CustomerSiteId)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)
x
sites
sites[8]
turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
min(runs.reg.date[runs.reg.date$CustomerSiteId==13, 'Date'])
head(runs.reg.date)
ggplot(runs.reg.date[runs.reg.date$CustomerSiteId==13 & runs.reg.date$Panel=='RP', ], aes(x=YearWeek, y=Run)) + geom_bar(stat='identity')
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
b <- turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
b
with(b, Positivity/PostMed)
with(b, SpecRuns/SpecMed)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
b
head(b)
ggplot(b, aes(x=YearWeek, y=PositivityBaseline, group='Positivity', color='Positivity')) + geom_line() + geom_line(aes(x=YearWeek, y=RunRatio, group='Runs', color='Runs'), data=b)
ggplot(b, aes(x=YearWeek, y=PostivityBaseline, group='Positivity', color='Positivity')) + geom_line() + geom_line(aes(x=YearWeek, y=RunRatio, group='Runs', color='Runs'), data=b)
head(b)
ggplot(b, aes(x=YearWeek, y=PostivityRatio, group='Positivity', color='Positivity')) + geom_line() + geom_line(aes(x=YearWeek, y=RunRatio, group='Runs', color='Runs'), data=b)
ggplot(b, aes(x=YearWeek, y=PositivityRatio, group='Positivity', color='Positivity')) + geom_line() + geom_line(aes(x=YearWeek, y=RunRatio, group='Runs', color='Runs'), data=b)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
b <- turn(runs.reg.date, 'CustomerSiteId', sites[8], 'RP', calendar.df, 30)
ggplot(b, aes(x=YearWeek, y=PositiveRatio, group='Positivity', color='Positivity')) + geom_line() + geom_line(aes(x=YearWeek, y=RunRatio, group='Runs', color='Runs'), data=b)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
View(site.turn)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId) + labs(title='TURN')
View(site.turn)
rm(natn.turn.adj, site.turn.adj)
View(natn.turn)
site.turn[site.turn$YearWeek=='2013-31', ]
a <- site.turn[site.turn$YearWeek=='2013-31', ]
rm(a, b)
a <- site.turn[site.turn$YearWeek=='2013-31', ]
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId) + labs(title='TURN')
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
View(site.turn)
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='PosRatio', color='PosRatio'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','red','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN_v3')
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='PosRatio', color='PosRatio'), data=site.turn, size=1.5) + scale_color_manual(values=c('black','red','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN_v3')
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + geom_line(aes(x=YearWeek, y=PositiveRatio, group='PosRatio', color='PosRatio'), data=site.turn, size=1.5) + scale_color_manual(values=c('black','red','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN_v3')
source('~/FilmArrayTrend/Rfunctions/TURN.R', echo=TRUE)
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN_v1')
heas(site.turn)
head(site.turn)
source('~/FilmArrayTrend/Rfunctions/TURN_v3.R', echo=TRUE)
site.turn.v3 <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn.v3 <- with(site.turn.v3, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURNv1', color='SiteTURNv1')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='SiteTURNv3', color='SiteTURNv3'), data=site.turn.v3, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='SiteTURNv1', color='SiteTURNv1')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='SiteTURNv3', color='SiteTURNv3'), data=natn.turn.v3, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='SiteTURNv1', color='SiteTURNv1')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='SiteTURNv3', color='SiteTURNv3'), data=natn.turn.v3, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN')
head(natn.turn)
head(natn.turn.v3)
ggplot(natn.turn, aes(x=YearWeek, y=TURN, group='SiteTURNv1', color='SiteTURNv1')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='SiteTURNv3', color='SiteTURNv3'), data=natn.turn.v3, size=1.5) + scale_color_manual(values=c('black','blue'))
View(site.turn.v3)
rm(site.turn.v3, natn.turn.v3)
source('../Rfunctions/TURN_v3.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
site.turn <- do.call(rbind, lapply(1:length(sites), function(x) turn(runs.reg.date, 'CustomerSiteId', sites[x], 'RP', calendar.df, 30)))
natn.turn <- with(site.turn, aggregate(TURN~YearWeek, FUN=mean))
ggplot(site.turn, aes(x=YearWeek, y=TURN, group='SiteTURN', color='SiteTURN')) + geom_line(size=1.5) + geom_line(aes(x=YearWeek, y=TURN, group='NationalTURN', color='NationalTURN'), data=natn.turn, size=1.5) + scale_color_manual(values=c('black','blue')) + facet_wrap(~CustomerSiteId, scale='free_y') + labs(title='TURN_v1')
heaD(site.turn)
head(site.turn)
head(runs.reg.date)
runs.reg.date[runs.reg.date$Panel==]
runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ]
head(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ])
with(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ], aggregate(Run~YearWeek+CustomerSiteId+Region, FUN=sum))
neg.runs <- with(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ], aggregate(Run~YearWeek+CustomerSiteId+Region, FUN=sum))
head(neg.runs)
expand.grid(height = seq(60, 80, 5), weight = seq(100, 300, 50), sex = c("Male","Female"))
head(neg.runs)
expand.grid(neg.runs$YearWeek, neg.runs$CustomerSiteId)
head(expand.grid(unique(neg.runs$YearWeek), unique(neg.runs$CustomerSiteId)))
expand.grid(YearWeek = unique(neg.runs$YearWeek), CustomerSiteId = unique(neg.runs$CustomerSiteId))
base.df <- expand.grid(YearWeek = unique(neg.runs$YearWeek), CustomerSiteId = unique(neg.runs$CustomerSiteId))
4389/19
length(sites)
neg.runs <- merge(base.df, neg.runs, by=c('YearWeek','CustomerSiteId'), all.x=TRUE)
head(neg.runs)
neg.runs <- with(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ], aggregate(Run~YearWeek+CustomerSiteId, FUN=sum))
base.df <- expand.grid(YearWeek = unique(neg.runs$YearWeek), CustomerSiteId = unique(neg.runs$CustomerSiteId))
neg.runs <- merge(base.df, neg.runs, by=c('YearWeek','CustomerSiteId'), all.x=TRUE)
neg.runs[is.na(Run),'Run'] <- 0
head(neg.runs)
neg.runs[is.na(neg.runs$Run),'Run'] <- 0
unique(base.df$YearWeek)
unique(base.df$YearWeek)[order(as.character(unique(base.df$YearWeek)))]
year.weeks <- as.character(unique(base.df$YearWeek))[order(as.character(unique(base.df$YearWeek)))]
rm(year.weeks)
neg.runs <- neg.runs[with(neg.runs, order(CustomerSiteId, YearWeek)), ]
year.weeks <- as.character(unique(base.df$YearWeek))[order(as.character(unique(base.df$YearWeek)))]
do.call(rbind, lapply(1:length(sites), function(x) data.frame(CustomerSiteId = sites[x], Negatives = sapply(2:(length(year.weeks)), function(y) sum(neg.runs[neg.runs$CustomerSiteId==sites[x],'Runs'][(y-1):(y+1)])))))
neg.roll <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(CustomerSiteId = sites[x], Negatives = sapply(2:(length(year.weeks)), function(y) sum(neg.runs[neg.runs$CustomerSiteId==sites[x],'Runs'][(y-1):(y+1)])))))
View(neg.roll)
neg.roll <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(2:(length(year.weeks)), function(y) data.frame(CustomerSiteId = sites[x], YearWeek = year.weeks[y], Negatives = sum(neg.runs[neg.runs$CustomerSiteId==sites[x],'Run'][(y-1):(y+1)]))))))
View(neg.roll)
head(neg.runs[neg.runs$CustomerSiteId==41, ])
8+39+11
39+11+25
head(neg.roll)
unique(runs.reg.date[,c('CustomerSiteId','Region')])
regions.df
unique(runs.reg.date[,c('CustomerSiteId','Region')])
site.reg <- unique(runs.reg.date[,c('CustomerSiteId','Region')])
neg.roll <- merge(neg.roll, site.reg, by='CustomerSiteId')
head(neg.roll)
hest(site.turn)
head(site.turn)
site.overview <- merge(site.turn[,c('CustomerSiteId','YearWeek','SpecRuns','SpecPositives','TURN')], neg.roll, by=c('CustomerSiteId','YearWeek'))
head(site.overview)
colnames(site.overview)[3:4]
colnames(site.overview)[3:4] <- c('Runs','Positives')
head(site.overview)
site.overview$PositiveRate <- with(site.overview, Positives/Runs)
site.overview$NegativeRate <- with(site.overview, Negatives/Runs)
head(site.overview)
ggplot(site.overview, aes(x=YearWeek, y=PositiveRate, group='Positive', color='Positive')) + geom_line() + geom_line(aes(x=YearWeek, y=NegativeRate, group='Negative', color='Negative'), data=site.overview) + facet_wrap(~CustomerSiteId)
ggplot(site.overview, aes(x=YearWeek, y=PositiveRate, group='Positive', color='Positive')) + geom_line() + geom_line(aes(x=YearWeek, y=NegativeRate, group='Negative', color='Negative'), data=site.overview) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'))
head(runs.df)
head(site.overview)
head(names.df)
neg.runs <- with(runs.reg.date[runs.reg.date$Panel=='RP' & runs.reg.date$Positive==0, ], aggregate(Run~YearWeek+CustomerSiteId, FUN=sum))
base.df <- expand.grid(YearWeek = unique(neg.runs$YearWeek), CustomerSiteId = unique(neg.runs$CustomerSiteId))
neg.runs <- merge(base.df, neg.runs, by=c('YearWeek','CustomerSiteId'), all.x=TRUE)
neg.runs[is.na(neg.runs$Run),'Run'] <- 0
neg.runs <- neg.runs[with(neg.runs, order(CustomerSiteId, YearWeek)), ]
year.weeks <- as.character(unique(base.df$YearWeek))[order(as.character(unique(base.df$YearWeek)))]
neg.roll <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(2:(length(year.weeks)), function(y) data.frame(CustomerSiteId = sites[x], YearWeek = year.weeks[y], Negatives = sum(neg.runs[neg.runs$CustomerSiteId==sites[x],'Run'][(y-1):(y+1)]))))))
neg.roll <- merge(neg.roll, names.df[,c('CustomerSiteId','CensusRegionNational','CensusRegionLocal')], by='CustomerSiteId')
site.overview <- merge(site.turn[,c('CustomerSiteId','YearWeek','SpecRuns','SpecPositives','TURN')], neg.roll, by=c('CustomerSiteId','YearWeek'))
colnames(site.overview)[3:4] <- c('Runs','Positives')
site.overview$PositiveRate <- with(site.overview, Positives/Runs)
site.overview$NegativeRate <- with(site.overview, Negatives/Runs)
head(site.overview)
grep('Child', names.df$Name)
names.df[grep('Child', names.df$Name), ]
head(site.overview)
names.df[grep('Child', names.df$Name), ]
names.df[grep('Child', names.df$Name), 'CustomerSiteId']
names.df[grep('Child', names.df$Note), 'CustomerSiteId']
c(names.df[grep('Child', names.df$Name), 'CustomerSiteId'], names.df[grep('Child', names.df$Note), 'CustomerSiteId'])
unique(c(names.df[grep('Child', names.df$Name), 'CustomerSiteId'], names.df[grep('Child', names.df$Note), 'CustomerSiteId']))
peds.sites <- unique(c(names.df[grep('Child', names.df$Name), 'CustomerSiteId'], names.df[grep('Child', names.df$Note), 'CustomerSiteId']))
head(site.overview)
peds.overview <- site.overview[site.overview$CustomerSiteId %in% peds.sites, ]
with(peds.overview, aggregate(NegativeRate~YearWeek, FUN=mean))
ggplot(with(peds.overview, aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point()
ggplot(with(peds.overview, aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)])
rota.nat.nrevss <- read.csv('../DataSources/NREVSS/Rotavirus_National.csv', header=TRUE)
head(rota.nat.nrevss)
rota.nat.nrevss <- read.csv('../DataSources/NREVSS/Rotavirus_National.csv', header=TRUE)
head(rota.nat.nrevss)
class(rota.nat.nrevss$Date)
as.Date(rota.nat.nrevss$Date)
as.Date(as.character(rota.nat.nrevss$Date), format = '%m-%d-%Y')
as.Date(as.character(rota.nat.nrevss$Date), format = '%m/%d/%Y')
rota.nat.nrevss$Date <- as.Date(as.character(rota.nat.nrevss$Date), format = '%m/%d/%Y')
head(calendar.df)
merge(rota.nat.nrevss, calendar.df, by='Date')
rota.nat.nrevss <- merge(rota.nat.nrevss, calendar.df, by='Date')
head(rota.nat.nrevss)
head(rota.nat.nrevss)
ggplot(with(subset(peds.overview, YearWeek >= '2014-01'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)])
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2014-01'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)])
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2014-01'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/100, group='NREVSS', color='NREVSS'), data=rota.nat.nrevss)
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2014-01'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/10, group='NREVSS', color='NREVSS'), data=rota.nat.nrevss)
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/10, group='NREVSS', color='NREVSS'), data=rota.nat.nrevss)
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate)) + geom_point() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/100, group='NREVSS', color='NREVSS'), data=rota.nat.nrevss)
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate, color='Negative Rate', group='Negative Rate')) + geom_line() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/100, group='NREVSS Rotavirus', color='NREVSS Rotavirus'), data=rota.nat.nrevss, lwd=1.5) + geom_line(data=with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(TURN~YearWeek, FUN=mean), aes(x=YearWeek, y=TURN, group='TURN',color='TURN'), lwd=1.5) + scale_color_manual(values=c('black','blue','red'))
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate, color='Negative Rate', group='Negative Rate')) + geom_line() + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/100, group='NREVSS Rotavirus', color='NREVSS Rotavirus'), data=rota.nat.nrevss, lwd=1.5) + geom_line(data=with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(TURN~YearWeek, FUN=mean)), aes(x=YearWeek, y=TURN, group='TURN', color='TURN'), lwd=1.5) + scale_color_manual(values=c('black','blue','red'))
ggplot(with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(NegativeRate~YearWeek, FUN=mean)), aes(x=YearWeek, y=NegativeRate, color='Negative Rate', group='Negative Rate')) + geom_line(lwd=1.5) + scale_x_discrete(breaks = unique(peds.overview$YearWeek)[seq(1, length(unique(peds.overview$YearWeek)), 12)]) + geom_line(aes(x=YearWeek, y=AntigenDetection/100, group='NREVSS Rotavirus', color='NREVSS Rotavirus'), data=rota.nat.nrevss, lwd=1.5) + geom_line(data=with(subset(peds.overview, as.character(YearWeek) >= '2015-30'), aggregate(TURN~YearWeek, FUN=mean)), aes(x=YearWeek, y=TURN/10, group='TURN', color='TURN'), lwd=1.5) + scale_color_manual(values=c('black','blue','red'))
library(RODBC)
library(lubridate)
library(xlsx)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(dplyr)
library(tidyr)
require(dateManip)
source('../Rfunctions/TURN_v3.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
read.xlsx('../DataSources/GoogleFlu.xlsx', sheetName='Sheet1', colIndex = c(1,2,3))
goog.flu <- read.xlsx('../DataSources/GoogleFlu.xlsx', sheetName='Sheet1', colIndex = c(1,2,3))
head(goog.flu)
head(regions.df)
regions.df[regions.df$CDCRegion==1, ]
regions.df[regions.df$CDCRegion==10, ]
tail(cdc.reg.df)
cdc.hhs.df <- read.csv('../DataSources/Epidemics/HHSregionalILI.csv', header=TRUE, sep=',')
