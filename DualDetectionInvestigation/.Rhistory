head(rand.agg)
qnorm(0.975)
qnorm(0.025)
rand.agg$LowerCI <- rand.agg$RiskRatio + qnorm(0.025)*sqrt(rand.agg$RiskVariance)
rand.agg$UpperCI <- rand.agg$RiskRatio + qnorm(0.975)*sqrt(rand.agg$RiskVariance)
head(rand.agg)
head(rand.sample)
with(rand.sample, aggregate(UniquePositives~YearWeek, FUN=sd))
rand.unique.sdev <- with(rand.sample, aggregate(UniquePositives~YearWeek, FUN=sd))
rand.agg <- with(rand.sample, aggregate(cbind(UniquePositives, CoDetectionRate, RiskRatio, RiskVariance)~YearWeek, FUN=mean))
rand.unique.sdev <- with(rand.sample, aggregate(UniquePositives~YearWeek, FUN=sd))
merge(rand.agg, rand.unique.sdev, by='YearWeek')
rand.agg$LowerCI <- rand.agg$RiskRatio + qnorm(0.025)*sqrt(rand.agg$RiskVariance)
rand.agg$UpperCI <- rand.agg$RiskRatio + qnorm(0.975)*sqrt(rand.agg$RiskVariance)
rand.agg <- with(rand.sample, aggregate(cbind(UniquePositives, CoDetectionRate, RiskRatio, RiskVariance)~YearWeek, FUN=mean))
rand.unique.sdev <- with(rand.sample, aggregate(UniquePositives~YearWeek, FUN=sd))
rand.agg <- merge(rand.agg, rand.unique.sdev, by='YearWeek')
rand.agg$LowerCI <- rand.agg$RiskRatio + qnorm(0.025)*sqrt(rand.agg$RiskVariance)
rand.agg$UpperCI <- rand.agg$RiskRatio + qnorm(0.975)*sqrt(rand.agg$RiskVariance)
head(rand.agg)
colnames(rand.unique.sdev)[2]
rand.agg <- with(rand.sample, aggregate(cbind(UniquePositives, CoDetectionRate, RiskRatio, RiskVariance)~YearWeek, FUN=mean))
rand.unique.sdev <- with(rand.sample, aggregate(UniquePositives~YearWeek, FUN=sd))
colnames(rand.unique.sdev)[2] <- 'SdevUniquePositives'
rand.agg <- merge(rand.agg, rand.unique.sdev, by='YearWeek')
rand.agg$LowerCI <- rand.agg$RiskRatio + qnorm(0.025)*sqrt(rand.agg$RiskVariance)
rand.agg$UpperCI <- rand.agg$RiskRatio + qnorm(0.975)*sqrt(rand.agg$RiskVariance)
head(rand.agg)
ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Count of Unique Organisms Circulating', x='Date')
p.UniqueCirculatingOrganismsSampled <- ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Count of Unique Organisms Circulating', x='Date')
ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Unique Organisms +/- 1 Standard Deviation', x='Date')
p.UniqueCirculatingOrganismsSampled <- ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Unique Organisms +/- 1 Standard Deviation', x='Date')
p.CoDetectionsAndRiskMetricSingleAxis <- ggplot(rand.agg, aes(x=YearWeek, y=CoDetectionRate, fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=RiskRatio, group='Risk Metric', color='Risk Metric', fill='Risk Metric'), lwd=1.5, color='black', data=rand.agg) + scale_fill_manual(values=c('grey','black'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = dateBreaks, labels=dateLabels) + labs(y='Co-Detections/Tests, Risk Metric', x='Date') + scale_y_continuous(limits=c(0, 0.6), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0))
p.UniqueCirculatingOrganismsSampled <- ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Unique Organisms +/- 1 Standard Deviation', x='Date')
head(rand.agg)
ggplot(rand.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point()
ggplot(rand.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_ribbon(aes(ymin=LowerCI, ymax=UpperCI), alpha=0.2, data=rand.agg)
workDir <-'~/FilmArrayTrend/DualDetectionInvestigation/'
setwd(workDir)
# load libraries
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
install_github('BioAimie/dateManip')
library(dateManip)
ggplot(rand.agg, aes(x=YearWeek, y=CoDetectionRate, fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=RiskRatio, group='Risk Metric', color='Risk Metric', fill='Risk Metric'), lwd=1.5, color='black', data=rand.agg) + scale_fill_manual(values=c('grey','black'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = dateBreaks, labels=dateLabels) + labs(y='Co-Detections/Tests, Risk Metric', x='Date') + scale_y_continuous(limits=c(0, 0.6), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0))
ggplot(rand.agg, aes(x=YearWeek, y=100*CoDetectionRate, fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=25*RiskRatio, group='Risk Metric', color='Risk Metric', fill='Risk Metric'), lwd=1.5, color='black', data=rand.agg) + scale_fill_manual(values=c('grey','black'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = dateBreaks, labels=dateLabels) + labs(y='Co-Detections/Tests, Risk Metric', x='Date')
ggplot(aes(x=DateGroup, y=25*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.ci.agg) + geom_line(size=2) + geom_ribbon(aes(ymin=25*LL, ymax=25*UL), alpha=0.2, data=risk.count.cos.ci.agg, color='transparent', fill='blue') + geom_line(aes(x=DateGroup, y=100*CoDetectionRate, color='Co-Detections/Total Runs', group='Co-Detections/Total Runs'), data=risk.count.cos.ci.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = dateBreaks, labels=dateLabels) + scale_color_manual(values=c('black','blue'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(title='', y='Co-Detection Rate (%)', x='Date') + scale_y_continuous(limits=c(0, 16), breaks=c(0,2,4,6,8,10,12,14,16))
ggplot(aes(x=YearWeek, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=rand.agg) + geom_line(size=2) + geom_ribbon(aes(x=YearWeek, ymin=(UniquePositives-SdevUniquePositives), ymax=(UniquePositives+SdevUniquePositives)), data=rand.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Unique Organisms +/- 1 Standard Deviation', x='Date')
ggplot(rand.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_ribbon(aes(ymin=LowerCI, ymax=UpperCI), alpha=0.2, data=rand.agg)
head(risk.count.cos.ci.agg)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point()
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_ribbon(aes(ymin=LL, ymax=UL), alpha=0.2, data=risk.count.cos.ci.agg)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_ribbon(aes(x=CoDetectionRate, ymin=LL, ymax=UL), alpha=0.2, data=risk.count.cos.ci.agg)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_smooth()
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point()
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(aes(x=CoDetectionRate, y=lm(RiskRatio~CoDetectionRate)))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point()
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)
summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))
attributes(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]]
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]]
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]])
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=3)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)
ggplot(risk.count.cos.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=25*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,14), breaks=c(0, 2, 4, 6, 8, 10, 12, 14)) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%)', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,14), breaks=c(0, 2, 4, 6, 8, 10, 12, 14)) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%)', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%)', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM (%)', x='Date')
p.CosAndRiskOnSingleAxisFinalFormat <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM (%)', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank())
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%')) + scale_y_continuous(limits=c(0, 0.5))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%')) + scale_y_continuous(limits=c(0, 0.55))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%')) + scale_y_continuous(limits=c(0, 0.5))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.125), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank())
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 0.5))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 1))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 1), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 1), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 1), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2)+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0%','10.0%','20.0%','30.0%','40.0%','50.0%','60.0%','70.0%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='grey')+ theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0%','10.0%','20.0%','30.0%','40.0%','50.0%','60.0%','70.0%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0%','2.5%','5.0%','7.5%','10.0%','12.5%','15.0%')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0%','10.0%','20.0%','30.0%','40.0%','50.0%','60.0%','70.0%'))
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label='R2 = X')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label='R2 = X', size=12)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$r.squared, sep=' '), size=12)
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$r.squared
attributes(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))
summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))
attributes(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)))
summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=12)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
p.CoDetVsTCPM <- ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM (%)', x='Date')
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
install_github('BioAimie/dateManip')
library(dateManip)
heaD(risk.count.cos.ci.agg)
head(risk.count.cos.ci.agg)
eigen(risk.count.cos.ci.agg$RiskRatio)
matrix(risk.count.cos.ci.agg$CoDetectionRate)
matrix(0, nrow=length(risk.count.cos.ci.agg$CoDetectionRate), ncol=length(risk.count.cos.ci.agg$CoDetectionRate))
a <- matrix(0, nrow=length(risk.count.cos.ci.agg$CoDetectionRate), ncol=length(risk.count.cos.ci.agg$CoDetectionRate))
View(a)
nrow(a)
for(i in 1:nrow(a)) { a[i, i] <- risk.count.cos.ci.agg$CoDetectionRate[i]}
View(a)
eigen(a)
e <- eigen(a)
e$values
e$vectors
b <- e$vectors
View(b)
rm(b)
e$values
head(risk.count.cos.ci.agg)
risk.count.cos.ci.agg$RiskRatio/e$values
e$vectors
b <- e$vectors
View(b)
head(risk.count.cos.ci.agg)
sqrt((risk.count.cos.ci.agg$CoDetectionRate-risk.count.cos.ci.agg$RiskRatio)^2)
with(risk.count.cos.ci.agg, dist(RiskRatio, CoDetectionRate))
with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate))
dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate))
dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
ed <- dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
rm(a, e)
ed
head(risk.count.cos.ci.agg)
ed*risk.count.cos.ci.agg$CoDetectionRate
a <- risk.count.cos.ci.agg
a$CoDetectionRateFactoredByED <- ed*risk.count.cos.ci.agg$CoDetectionRate
head(a)
ggplot(a, aes(x=DateGroup, y=CoDetectionRateFactoredByED)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio, group=1), data=a)
ggplot(a, aes(x=DateGroup, y=CoDetectionRateFactoredByED)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio, group=1), data=a, size=2)
ed
a$CoDetectionRateFactoredByED <- 2.5*risk.count.cos.ci.agg$CoDetectionRate
ggplot(a, aes(x=DateGroup, y=CoDetectionRateFactoredByED)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio, group=1), data=a, size=2)
ggplot(a, aes(x=DateGroup, y=100*CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=25*RiskRatio, group=1), data=a, size=2)
ggplot(a, aes(x=DateGroup, y=100*CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=25.5*RiskRatio, group=1), data=a, size=2)
25/100
2.55*100
ed <- dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
a <- risk.count.cos.ci.agg
a$CoDetectionRateFactoredByED <- ed*risk.count.cos.ci.agg$CoDetectionRate
head(a)
ed <- dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, 100*CoDetectionRate)))
a <- risk.count.cos.ci.agg
a$CoDetectionRateFactoredByED <- ed*risk.count.cos.ci.agg$CoDetectionRate
head(a)
head(a)
a$RiskRatio/ed
ed
ed <- dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
a <- risk.count.cos.ci.agg
a$CoDetectionRateFactoredByED <- ed*risk.count.cos.ci.agg$CoDetectionRate
a$CoDetectionRateFactoredByED <- risk.count.cos.ci.agg$RiskRatio/ed
a$RiskFactoredByED <- risk.count.cos.ci.agg$RiskRatio/ed
head(a)
ggplot(a, aes(x=DateGroup, y=CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskFactoredByED, group=1), data=a, size=2)
ggplot(a, aes(x=DateGroup, y=CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio/4, group=1), data=a, size=2)
lm(RiskRatio~CoDetectionRate, data=a)
summary(lm(RiskRatio~CoDetectionRate, data=a))
rm(a, ed)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(coef(m)[1], digits = 2),
b = format(coef(m)[2], digits = 2),
r2 = format(summary(m)$r.squared, digits = 3)))
as.character(as.expression(eq));
}
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + geom_text(x=0.125, y=0.6, label=lm(data.frame(risk.count.cos.ci.agg$CoDetectionRate, risk.count.cos.ci.agg$RiskRatio))) # + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(coef(m)[1], digits = 2),
b = format(coef(m)[2], digits = 2),
r2 = format(summary(m)$r.squared, digits = 3)))
as.character(as.expression(eq));
}
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + geom_text(x=0.125, y=0.6, label=lm(data.frame(risk.count.cos.ci.agg$CoDetectionRate, risk.count.cos.ci.agg$RiskRatio))) # + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + geom_text(x=0.125, y=0.6, label=lm(data.frame(risk.count.cos.ci.agg$CoDetectionRate, risk.count.cos.ci.agg$RiskRatio)), parse=TRUE)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('Ritalic(2) =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), parse=TRUE, size=10)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label="Ritalic(2) = round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3)", parse=TRUE, size=10)
rm(lm_eqn())
rm(lm_eqn
)
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)
attributes(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients
lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]]
risk.fit <- lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)
risk.fit$coefficients[[2]]
attributes(risk.fit)
attributes(summary(risk.fit))
summary(risk.fit)$r.squared
m <- round(risk.fit$coefficients[[2]], 2)
r <- round(summary(risk.fit)$r.squared, 3)
label.text <- "R(italic(i))=="
rm(label.text)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=m*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
m
head(risk.count.cos.ci.agg)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=m*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
ggplot(a, aes(x=DateGroup, y=CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio/4, group=1), data=a, size=2)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio/4, group=1), data=a, size=2)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=CoDetectionRate)) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio/4, group=1), data=risk.count.cos.ci.agg, size=2)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
p.CosAndRiskOnSingleAxisFinalFormat <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + geom_text(x=0.125, y=0.6, label=lm(data.frame(risk.count.cos.ci.agg$CoDetectionRate, risk.count.cos.ci.agg$RiskRatio))) # + annotate('text', x=0.12, y=0.6, label=paste('R2 =', round(summary(lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg))$r.squared, 3), sep=' '), size=10)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste('R2 =', r, sep=' '), size=10)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=10)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=8)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=6)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=4, face='bold')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.12, y=0.6, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
p.CoDetVsTCPM <- ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
rm(b)
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
install_github('BioAimie/dateManip')
library(dateManip)
p.CosAndRiskOnSingleAxisFinalFormat <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
p.CoDetVsTCPM <- ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
#####
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate, TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM (%)', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.text=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
install_github('BioAimie/dateManip')
library(dateManip)
grid.draw(overlayWithCI)
dev.off()
grid.draw(overlayWithCI)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
head(risk.count.cos.ci.agg)
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=LL, ymax=UL), data=risk.count.cos.ci.agg, alpha=0.1, color='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.1, color='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.1, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.2, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.15, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
p.CosAndRiskOnSingleAxisWithCIs <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.2, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
workDir <-'~/FilmArrayTrend/DualDetectionInvestigation/'
setwd(workDir)
# load libraries
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
library(dateManip)
# load user-defined functions
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
head(percent.det.site)
head(bugs.roll)
head(runs.roll)
# GET DATA ---------------------------------------------------------------------------------------------------------------
# read in the data from FilmArray Data Warehouse DB (ODBC object in Windows "FA_DW" with Lindsay's credentials)
FADWcxn <- odbcConnect(dsn = 'FA_DW', uid = 'afaucett', pwd = 'ThisIsAPassword-BAD')
queryVector <- scan('../DataSources/SQL/DualDetectionsInvestigation/AllSitesRespiratoryTrendableRuns.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
runs.df <- sqlQuery(FADWcxn,query)
queryVector <- scan('../DataSources/SQL/DualDetectionsInvestigation/PositiveBugsRP.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
bugs.df <- sqlQuery(FADWcxn,query)
queryVector <- scan('../DataSources/SQL/DualDetectionsInvestigation/ShortNames.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
nicknames.df <- sqlQuery(FADWcxn,query)
odbcClose(FADWcxn)
# read in data from PMS PROD server
PMScxn <- odbcConnect('PMS_PROD')
queryVector <- scan('../DataSources/sql/DualDetectionsInvestigation/AllSitesRegionKey.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
regions.df <- sqlQuery(PMScxn,query)
odbcClose(PMScxn)
# FORMAT DATA ------------------------------------------------------------------------------------------------------------
# add regions and epi dates to the run data
calendar.df <- createCalendarLikeMicrosoft(2012, 'Week')
calendar.df <- transformToEpiWeeks(calendar.df)
calendar.df$YearWeek <- with(calendar.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
runs.reg <- merge(runs.df, data.frame(Province = regions.df$StateAbv, Region = regions.df$CensusRegionLocal), by='Province')
runs.reg$Record <- 1
runs.reg <- merge(runs.reg[,c('RunDataId','Date','Name','CustomerSiteId','Region','Record')], calendar.df[,c('Date','Year','Week','YearWeek')], by='Date')
colnames(runs.reg)[grep('Record', colnames(runs.reg))] <- 'Runs'
# combine flu As into one bug and then add epi dates and sites to the bugs data
bugs.df <- unique(bugs.df)
bugs.df <- merge(bugs.df, nicknames.df, by.x='BugPositive', by.y='Organism')
bugs.df$BugPositive <- as.character(bugs.df$BugPositive)
bugs.df$ShortName <- as.character(bugs.df$ShortName)
# # remove this if we do not plan to group all Flu As... dual detections of H1-2009, H3 and H1, H3 have been seen. No subtype and Flu A haven't
# # occurred in a dual detection with any other Flu A type in the data set as of 10/20/2016.
# bugs.df[grep('Influenza A', bugs.df$BugPositive), 'ShortName'] <- 'Influenza A (all)'
bugs.reg <- merge(runs.reg[,c('RunDataId','YearWeek','CustomerSiteId')], bugs.df, by='RunDataId')
colnames(bugs.reg)[grep('ShortName', colnames(bugs.reg))] <- 'Bug'
# CLEAN DATA -------------------------------------------------------------------------------------------------------------
# do not keep sites that have less than 10 runs in a given week because this will skew the data set
runs.agg <- with(runs.reg, aggregate(Runs~YearWeek+CustomerSiteId+Name+Region, FUN=sum))
bugs.agg <- with(data.frame(bugs.reg, Positives = 1), aggregate(Positives~YearWeek+CustomerSiteId+Bug, FUN=sum))
runs.trim <- runs.agg[runs.agg$Runs >= 10, ]
positives.trim <- merge(runs.trim, bugs.agg, by=c('YearWeek','CustomerSiteId'))
# ANALYSIS ---------------------------------------------------------------------------------------------------------------
# For each site, count the number of distinct organisms testing positives in a period, then take an average accross all sites
positives.unique <- data.frame(positives.trim[,c('YearWeek','CustomerSiteId','Bug')], Count = 1)
distinct.postives.site <- with(positives.unique, aggregate(Count~YearWeek+CustomerSiteId, FUN=sum))
distinct.positives.avg <- with(distinct.postives.site, aggregate(Count~YearWeek, FUN=mean))
# For each site, determine the number of dual detections in a period, then take the average accross all sites
test.detections <- with(data.frame(bugs.reg, Positives = 1), aggregate(Positives~RunDataId, FUN=sum))
###### (this actually is taking up to 4 detections)
co.detections <- bugs.reg[bugs.reg$RunDataId %in% test.detections[test.detections$Positives > 1, 'RunDataId'], ]
co.detections <- co.detections[with(co.detections, order(RunDataId, Bug)), ]
co.detections.concat <- do.call(rbind, lapply(1:length(unique(co.detections$RunDataId)), function(x) data.frame(RunDataId = unique(co.detections$RunDataId)[x], Bugs = paste0(co.detections[co.detections$RunDataId==unique(co.detections$RunDataId)[x],'Bug'], collapse = ', '))))
co.detections.agg <- merge(co.detections.concat, runs.reg[,c('RunDataId','CustomerSiteId','YearWeek')], by='RunDataId')
distinct.cos.bugs.site <- unique(co.detections.agg[,c('YearWeek','CustomerSiteId','Bugs')])
distinct.cos.bugs.site$Count <- 1
distinct.cos.site <- with(distinct.cos.bugs.site, aggregate(Count~YearWeek+CustomerSiteId, FUN=sum))
distinct.cos.avg <- with(distinct.cos.site, aggregate(Count~YearWeek, FUN=mean))
# put all the data into one data frame
distinct.df <- merge(distinct.positives.avg, distinct.cos.avg, by='YearWeek', all.x=TRUE)
ggplot(distinct.df, aes(x=YearWeek, y=Count.x, fill='Count Unique')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Count.y, group='Count Co-Detections', group='Count Co-Detections'), data=distinct.df, lwd=1.5) + scale_color_manual(values=c('black'), name='') + scale_fill_manual(values=c('dodgerblue'), name='')
# -------------------------------------------------------------------------------------------------------------------------
# Lindsay would like to see the percent of runs that are dual detections by week and correlate that to the unique organisms
# circulating in a given week. This needs to be a rolling average for smoothing...
# -------------------------------------------------------------------------------------------------------------------------
# for each site, get the number of unique bugs showing up in each week... if there are gaps, fill them with zeros
bugs.sparse <- merge(runs.reg[,c('Year','Week','RunDataId','CustomerSiteId')], bugs.df, by='RunDataId')
bugs.sparse$Positives <- 1
calendar.alt <- data.frame(Date = calendar.df$Date, Year = calendar.df$Year, Week = calendar.df$Week, DateGroup = calendar.df$YearWeek)
calendar.alt$DateGroup <- as.character(calendar.alt$DateGroup)
bugs.fill <- aggregateAndFillDateGroupGaps(calendar.alt, 'Week', bugs.sparse, c('CustomerSiteId','BugPositive','ShortName'), min(bugs.agg$YearWeek), 'Positives', 'sum', 0)
# remove Flu A (equivocal) and Flu A (no subtype)
##### do we still want to do this? how should co-detections that already exist be handled... e.g. if a person is HRv+RSV, should they be excluded???
bugs.fill.trim <- bugs.fill[!(bugs.fill$ShortName %in% c('Flu A','Flu A (no subtype)')), ]
bugs.fill.trim$UniquePositives <- with(bugs.fill.trim, ifelse(Positives > 0, 1, 0))
bugs.fill.agg <- with(bugs.fill.trim, aggregate(UniquePositives~DateGroup+CustomerSiteId+BugPositive+ShortName, FUN=sum))
site.bugs.unique <- with(bugs.fill.agg, aggregate(UniquePositives~DateGroup+CustomerSiteId, FUN=sum))
site.bugs.roll <- do.call(rbind, lapply(1:length(unique(site.bugs.unique$CustomerSiteId)), function(x) data.frame(DateGroup = site.bugs.unique[site.bugs.unique$CustomerSiteId==unique(site.bugs.unique$CustomerSiteId)[x], 'DateGroup'][3:(length(site.bugs.unique[site.bugs.unique$CustomerSiteId==unique(site.bugs.unique$CustomerSiteId)[x], 'DateGroup'])-2)], CustomerSiteId = unique(site.bugs.unique$CustomerSiteId)[x], UniquePositives = sapply(3:(length(site.bugs.unique[site.bugs.unique$CustomerSiteId==unique(site.bugs.unique$CustomerSiteId)[x], 'DateGroup'])-2), function(y) sum(site.bugs.unique[site.bugs.unique$CustomerSiteId==unique(site.bugs.unique$CustomerSiteId)[x], 'UniquePositives'][(y-2):(y+2)])/5))))
# for each site, get the percent of runs that are dual detections in a given week
co.detection.runs <- unique(test.detections[test.detections$Positives > 1, 'RunDataId'])
cos.sparse <- runs.reg[runs.reg$RunDataId %in% co.detection.runs, c('Year','Week','CustomerSiteId','Runs')]
cos.fill <- aggregateAndFillDateGroupGaps(calendar.alt, 'Week', cos.sparse, c('CustomerSiteId'), min(bugs.agg$YearWeek), 'Runs', 'sum', 0)
runs.fill <- aggregateAndFillDateGroupGaps(calendar.alt, 'Week', runs.reg[,c('Year','Week','CustomerSiteId','Runs')], c('CustomerSiteId'), min(bugs.agg$YearWeek), 'Runs', 'sum', 0)
colnames(cos.fill) <- c('DateGroup','CustomerSiteId','CoDetections')
# find the rolling 5-week average of dual detections per total runs
runs.roll <- do.call(rbind, lapply(1:length(unique(runs.fill$CustomerSiteId)), function(x) data.frame(DateGroup = runs.fill[runs.fill$CustomerSiteId==unique(runs.fill$CustomerSiteId)[x], 'DateGroup'][3:(length(runs.fill[runs.fill$CustomerSiteId==unique(runs.fill$CustomerSiteId)[x], 'DateGroup'])-2)], CustomerSiteId = unique(runs.fill$CustomerSiteId)[x], Runs = sapply(3:(length(runs.fill[runs.fill$CustomerSiteId==unique(runs.fill$CustomerSiteId)[x], 'DateGroup'])-2), function(y) sum(runs.fill[runs.fill$CustomerSiteId==unique(runs.fill$CustomerSiteId)[x], 'Runs'][(y-2):(y+2)])))))
cos.roll <- do.call(rbind, lapply(1:length(unique(cos.fill$CustomerSiteId)), function(x) data.frame(DateGroup = cos.fill[cos.fill$CustomerSiteId==unique(cos.fill$CustomerSiteId)[x], 'DateGroup'][3:(length(cos.fill[cos.fill$CustomerSiteId==unique(cos.fill$CustomerSiteId)[x], 'DateGroup'])-2)], CustomerSiteId = unique(cos.fill$CustomerSiteId)[x], CoDetections = sapply(3:(length(cos.fill[cos.fill$CustomerSiteId==unique(cos.fill$CustomerSiteId)[x], 'DateGroup'])-2), function(y) sum(cos.fill[cos.fill$CustomerSiteId==unique(cos.fill$CustomerSiteId)[x], 'CoDetections'][(y-2):(y+2)])))))
threshold <- 30
cos.rate <- merge(runs.roll, cos.roll, by=c('DateGroup','CustomerSiteId'))
cos.rate[cos.rate$Runs <= threshold, 'Runs'] <- NA
cos.rate$CoDetectionRate <- with(cos.rate, CoDetections/Runs)
cos.rate.avg <- with(cos.rate, aggregate(CoDetectionRate~DateGroup, FUN=mean))
# some site/date combinations have zero unique positives because they had < 10 runs... merge this to the runs.roll to check the run count
site.bugs.roll <- merge(site.bugs.roll, runs.roll, by=c('DateGroup','CustomerSiteId'))
site.bugs.roll[site.bugs.roll$Runs < threshold, 'UniquePositives'] <- NA
sites.bugs.roll <- site.bugs.roll[,c('DateGroup','CustomerSiteId','UniquePositives')]
bug.count.avg <- with(sites.bugs.roll, aggregate(UniquePositives~DateGroup, FUN=mean))
# combine the data & make a chart
rolled.df <- merge(cos.rate.avg, bug.count.avg, by='DateGroup')
p.co.count.combo <- ggplot(subset(rolled.df, as.character(DateGroup) >= '2013-33'), aes(x=DateGroup, y=CoDetectionRate*100, fill='Rate Of Co-Detections')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=UniquePositives, color='Unique Organisms', group='Unique Organisms'), data=subset(rolled.df, as.character(DateGroup) >= '2013-33'), lwd=1.5) + scale_fill_manual(values='darkgrey', name='') + scale_color_manual(values='blue', name='') + scale_x_discrete(breaks=as.character(unique(subset(rolled.df, as.character(DateGroup) >= '2013-33')$DateGroup))[order(as.character(unique(subset(rolled.df, as.character(DateGroup) >= '2013-33')$DateGroup)))][seq(1, length(as.character(unique(subset(rolled.df, as.character(DateGroup) >= '2013-33')$DateGroup))),8)]) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=20, color='black'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + labs(title='Unique Organisms in Circulation and Rate of Co-Detections\n(Averaged Across All Participating Trend Sites)', y='Unique Circulating Organisms (Count), Co-Detections (%)', x='Date')
with(subset(rolled.df, as.character(DateGroup) >= '2013-33'), cor(UniquePositives, CoDetectionRate))
with(subset(rolled.df, as.character(DateGroup) >= '2013-33'), plot(UniquePositives, CoDetectionRate))
abline(lm(CoDetectionRate~UniquePositives, data=subset(rolled.df, as.character(DateGroup) >= '2013-33')), col='blue', lwd=1.5)
# -----------------------------------------------------------------------------------------------------------
# Create a metric that's like a risk index for susceptibility... for example, if there's 3 organisms circulating
# and one is much more prevalent than the others, this should lower the risk index from 3 to something else
# -----------------------------------------------------------------------------------------------------------
# first, create a data frame that has all the bugs by site with placeholders of 0 if there are no positive tests
bugs <- as.character(unique(bugs.fill.trim$ShortName))
sites <- as.character(unique(bugs.fill.trim$CustomerSiteId))
missing.entries <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(CustomerSiteId=sites[x], ShortName = length(bugs[!(bugs %in% unique(as.character(bugs.fill.trim[bugs.fill.trim$CustomerSiteId == sites[x], 'ShortName'])))]))))
missing.sites <- as.character(missing.entries[missing.entries$ShortName > 0, 'CustomerSiteId'])
bugs.sparse.add <- do.call(rbind, lapply(1:length(missing.sites), function(x) data.frame(CustomerSiteId=missing.sites[x], ShortName = bugs[!(bugs %in% unique(as.character(bugs.fill.trim[bugs.fill.trim$CustomerSiteId == missing.sites[x], 'ShortName'])))], Positives = 0)))
bugs.sparse.add$Year <- max(bugs.sparse$Year)
bugs.sparse.add$Week <- min(bugs.sparse$Week)
bugs.sparse.update <- rbind(bugs.sparse[,c('Year','Week','CustomerSiteId','ShortName','Positives')], bugs.sparse.add[,c('Year','Week','CustomerSiteId','ShortName','Positives')])
bugs.roll <- aggregateAndFillDateGroupGaps(calendar.alt, 'Week', bugs.sparse.update, c('CustomerSiteId','ShortName'), min(bugs.agg$YearWeek), 'Positives', 'sum', 0)
bugs.roll <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(1:length(bugs), function(y) data.frame(DateGroup = bugs.roll[bugs.roll$CustomerSiteId==sites[x] & bugs.roll$ShortName==bugs[y], 'DateGroup'][3:(length(bugs.roll[bugs.roll$CustomerSiteId==sites[x] & bugs.roll$ShortName==bugs[y], 'DateGroup'])-2)], CustomerSiteId = sites[x], ShortName = bugs[y], Positives = sapply(3:(length(bugs.roll[bugs.roll$CustomerSiteId==sites[x] & bugs.roll$ShortName==bugs[y], 'DateGroup'])-2), function(z) sum(bugs.roll[bugs.roll$CustomerSiteId==sites[x] & bugs.roll$ShortName==bugs[y], 'Positives'][(z-2):(z+2)])))))))
# combine this with runs so that the percent detection for the period (5-week centered sums) can be calculated
percent.det.site <- merge(bugs.roll[,c('DateGroup','CustomerSiteId','ShortName','Positives')], runs.roll[,c('DateGroup','CustomerSiteId','Runs')], by=c('DateGroup','CustomerSiteId'))
# negatives should also be counted
negatives.sparse <- merge(runs.reg[,c('RunDataId','Year','Week','CustomerSiteId')], bugs.df[,c('RunDataId','ShortName')], by='RunDataId', all.x=TRUE)
negatives.sparse <- data.frame(negatives.sparse[is.na(negatives.sparse$ShortName), c('Year','Week','CustomerSiteId')], Negatives = 1)
negatives.fill <- aggregateAndFillDateGroupGaps(calendar.alt, 'Week', negatives.sparse, c('CustomerSiteId'), min(bugs.agg$YearWeek), 'Negatives', 'sum', 0)
negatives.roll <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(DateGroup = negatives.fill[negatives.fill$CustomerSiteId==sites[x],'DateGroup'][3:(length(negatives.fill[negatives.fill$CustomerSiteId==sites[x],'DateGroup'])-2)], CustomerSiteId = sites[x], Negatives = sapply(3:(length(negatives.fill[negatives.fill$CustomerSiteId==sites[x],'DateGroup'])-2), function(y) sum(negatives.fill[negatives.fill$CustomerSiteId==sites[x],'Negatives'][(y-2):(y+2)])))))
# combine the percent.det.site with the negative tests
percent.det.site <- merge(percent.det.site, negatives.roll, by=c('DateGroup','CustomerSiteId'))
percent.det.site$PercentDetection <- with(percent.det.site, Positives/Runs)
percent.det.site$PercentNegative <- with(percent.det.site, Negatives/Runs)
# # find the risk ratio... this is essentially the percent detection of a given organism in the 5-week centered period
# # multiplied by the total percent detection of all other organisms in the same period. The idea behind this is that
# # it will indicate the risk of a person who is positive for a single organism to contract any other organism when they
# # visit the hospital.
# periods <- as.character(unique(percent.det.site$DateGroup))[as.character(unique(percent.det.site$DateGroup)) >= '2013-33']
# riskratio.site <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(1:length(periods), function(y) do.call(rbind, lapply(1:length(bugs), function(z) data.frame(DateGroup = periods[y], CustomerSiteId = sites[x], ShortName = bugs[z], RiskRatio = percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*sum(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection']))))))))
# # see if this will work to filter out weeks where there are very few runs
# riskratio.site.mrg <- merge(runs.roll, riskratio.site, by=c('DateGroup','CustomerSiteId'))
# riskratio.site.mrg[riskratio.site.mrg$Runs <= threshold, 'RiskRatio'] <- NA
# # aggregate the risk ratios over all sites and take the mean for each period with 'enough' data and then add in the unique
# # organism count as well as the % dual detections
# riskratio.avg <- with(riskratio.site.mrg, aggregate(RiskRatio~DateGroup+ShortName, FUN=mean))
# risk.count.cos <- merge(merge(bug.count.avg, cos.rate.avg, by='DateGroup'), riskratio.avg, by='DateGroup')
# risk.count.cos.trim <- subset(risk.count.cos, as.character(DateGroup) >= '2013-33')
# # the correlation between the risk ratio and the count of unique organsims circulating is quite good
# cor(with(risk.count.cos.trim, aggregate(UniquePositives~DateGroup, FUN=mean))$UniquePositives, with(risk.count.cos.trim, aggregate(RiskRatio~DateGroup, FUN=sum))$RiskRatio)
# ggplot(risk.count.cos.trim[with(risk.count.cos.trim, order(DateGroup, ShortName, decreasing=TRUE)), ], aes(x=DateGroup)) + geom_area(aes(y=RiskRatio*25, fill=ShortName, order=ShortName, group=ShortName), stat='identity', position='stack') + geom_line(aes(x=DateGroup, y=CoDetectionRate*100, group='Co-Detections/Total Tests', color='Co-Detections/Total Tests'), size=2, data=risk.count.cos.trim) + geom_line(aes(x=DateGroup, y=UniquePositives, group='Unique Detections', color='Unique Detections'), size=2, data=risk.count.cos.trim) + scale_fill_manual(values=createPaletteOfVariableLength(risk.count.cos.trim, 'ShortName'), name='') + scale_color_manual(values=c('black','blue'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = as.character(unique(risk.count.cos.trim$DateGroup))[order(as.character(unique(risk.count.cos.trim$DateGroup)))][seq(1, length(as.character(unique(risk.count.cos.trim$DateGroup))), 8)]) + labs(title='Co-Detections, Unique Organism Detections, and Risk Ratio\n(5-week centered rolling average)', x='Year-Week', y='% Co-Detections, Organism Count, Risk Ratio')
#
# risk.count.cos.agg <- merge(with(risk.count.cos.trim, aggregate(UniquePositives~DateGroup, FUN=mean)), with(risk.count.cos.trim, aggregate(RiskRatio~DateGroup, FUN=sum)), by='DateGroup')
# risk.count.cos.agg <- merge(risk.count.cos.agg, with(risk.count.cos.trim, aggregate(CoDetectionRate~DateGroup, FUN=mean)), by='DateGroup')
# ggplot(risk.count.cos.agg, aes(x=DateGroup, y=100*CoDetectionRate, fill='Co-Detections/Total Runs')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=25*RiskRatio, group='Aggregate Risk Ratio', color='Aggregate Risk Ratio'), data=risk.count.cos.agg, size=2) + geom_line(aes(x=DateGroup, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = as.character(unique(risk.count.cos.trim$DateGroup))[order(as.character(unique(risk.count.cos.trim$DateGroup)))][seq(1, length(as.character(unique(risk.count.cos.trim$DateGroup))), 8)]) + scale_color_manual(values=c('blue','black'), name='') + scale_fill_manual(values='grey', name='')
#### RIGHT HERE!!!
# a <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(1:length(periods), function(y) do.call(rbind, lapply(1:length(bugs), function(z) data.frame(DateGroup = periods[y], CustomerSiteId = sites[x], ShortName = bugs[z], RiskRatio = percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*sum(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection']), mVariance = (percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*(1-percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection'])/percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'Runs'])*(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection'])^2)))))))
# a <- do.call(rbind, lapply(3:3, function(x) do.call(rbind, lapply(180:182, function(y) do.call(rbind, lapply(1:length(bugs), function(z) data.frame(DateGroup = periods[y], CustomerSiteId = sites[x], ShortName = bugs[z], RiskRatio = percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*sum(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection']), mVariance = (percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*(1-percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection'])/percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'Runs'])*(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection'])^2)))))))
# do.call(rbind, lapply(1:length(bugs), function(x) (((b[b$ShortName==bugs[x], 'Positives']/b[b$ShortName==bugs[x], 'Runs'])*(1-b[b$ShortName==bugs[x], 'Positives']/b[b$ShortName==bugs[x], 'Runs']))/b[b$ShortName==bugs[x], 'Runs'])*(sum(b[b$ShortName!=bugs[x],'Positives'])/b[b$ShortName==bugs[x], 'Runs'])^2))
# the issue is that the part finding the associated summation is returning an array, and that blows shit up
riskratio.site.ci <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(1:length(periods), function(y) do.call(rbind, lapply(1:length(bugs), function(z) data.frame(DateGroup = periods[y], CustomerSiteId = sites[x], ShortName = bugs[z], RiskRatio = percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*sum(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection']), mVariance = (((percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']*(1-percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'PercentDetection']))/percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName==bugs[z],'Runs'])*sum(percent.det.site[percent.det.site$CustomerSiteId==sites[x] & percent.det.site$DateGroup==periods[y] & percent.det.site$ShortName!=bugs[z],'PercentDetection'])^2))))))))
riskratio.site.ci.mrg <- merge(runs.roll, riskratio.site.ci, by=c('DateGroup','CustomerSiteId'))
riskratio.site.ci.mrg[riskratio.site.ci.mrg$Runs <= threshold, 'RiskRatio'] <- NA
riskratio.site.ci.mrg[riskratio.site.ci.mrg$Runs <= threshold, 'mVariance'] <- NA
ci.bounds <- with(riskratio.site.ci.mrg, aggregate(mVariance~DateGroup+CustomerSiteId, FUN=sum))
ci.bounds$mVariance <- 4*ci.bounds$mVariance
ci.bounds$sdev <- sqrt(ci.bounds$mVariance)
riskratio.ci.avg <- with(riskratio.site.ci.mrg, aggregate(RiskRatio~DateGroup+ShortName, FUN=mean))
risk.count.cos.ci <- merge(merge(merge(bug.count.avg, cos.rate.avg, by='DateGroup'), riskratio.ci.avg, by='DateGroup'), with(ci.bounds, aggregate(sdev~DateGroup, FUN=mean)), by='DateGroup')
risk.count.cos.ci.trim <- subset(risk.count.cos.ci, as.character(DateGroup) >= '2013-33')
risk.count.cos.ci.agg <- merge(with(risk.count.cos.ci.trim, aggregate(UniquePositives~DateGroup, FUN=mean)), with(risk.count.cos.ci.trim, aggregate(RiskRatio~DateGroup, FUN=sum)), by='DateGroup')
risk.count.cos.ci.agg <- merge(risk.count.cos.ci.agg, with(risk.count.cos.ci.trim, aggregate(CoDetectionRate~DateGroup, FUN=mean)), by='DateGroup')
risk.count.cos.ci.agg <- merge(risk.count.cos.ci.agg, with(risk.count.cos.ci.trim, aggregate(sdev~DateGroup, FUN=mean)), by='DateGroup')
risk.count.cos.ci.agg$LL <- risk.count.cos.ci.agg$RiskRatio - qnorm(0.975)*risk.count.cos.ci.agg$sdev
risk.count.cos.ci.agg$UL <- risk.count.cos.ci.agg$RiskRatio + qnorm(0.975)*risk.count.cos.ci.agg$sdev
# # get the Euclidean distance between the vectors of Risk and CoDetection
# ed <- dist(with(risk.count.cos.ci.agg, rbind(RiskRatio, CoDetectionRate)))
# a <- risk.count.cos.ci.agg
# a$RiskFactoredByED <- risk.count.cos.ci.agg$RiskRatio/ed
# a <- matrix(0, nrow=length(risk.count.cos.ci.agg$CoDetectionRate), ncol=length(risk.count.cos.ci.agg$CoDetectionRate))
# for(i in 1:nrow(a)) { a[i, i] <- risk.count.cos.ci.agg$CoDetectionRate[i]}
# e <- eigen(a)
#####
# change this code to make everything on one axis and remove the confidence interval (grey bars, red line) - TCPM
risk.fit <- lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)
m <- round(risk.fit$coefficients[[2]], 2)
r <- round(summary(risk.fit)$r.squared, 3)
p.CosAndRiskOnSingleAxisFinalFormat <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
p.CoDetVsTCPM <- ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
#####
p.CosAndRiskOnSingleAxisWithCIs <- ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.2, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
with(risk.count.cos.ci.agg, cor(RiskRatio, CoDetectionRate))
cos.risk.ccf <- ccf(risk.count.cos.ci.agg$RiskRatio, risk.count.cos.ci.agg$CoDetectionRate)
cos.risk.ccf.df <- data.frame(Lag = cos.risk.ccf$lag, CCF = cos.risk.ccf$acf)
cos.risk.ccf.df[cos.risk.ccf.df$CCF==max(cos.risk.ccf.df$CCF), ]
ggplot(risk.count.cos.ci.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=100*RiskRatio/m, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + geom_ribbon(aes(x=DateGroup, ymin=100*LL/4, ymax=100*UL/4), data=risk.count.cos.ci.agg, alpha=0.2, fill='red') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%), TCPM', x='Date')
m
ggplot(risk.count.cos.ci.agg, aes(x=CoDetectionRate, y=RiskRatio)) + geom_point() + geom_abline(intercept=lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[1]], slope = lm(RiskRatio~CoDetectionRate, data=risk.count.cos.ci.agg)$coefficients[[2]], size=2, color='black', alpha=0.2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_continuous(limits=c(0, 0.15), breaks=c(0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15), labels=c('0.0','2.5','5.0','7.5','10.0','12.5','15.0')) + scale_y_continuous(limits=c(0, 0.7), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), labels=c('0.0','10.0','20.0','30.0','40.0','50.0','60.0','70.0')) + labs(y='TCPM', x='Co-Detection Rate (%)') + annotate('text', x=0.125, y=0.625, label=paste(paste('R2 =', r, sep=' '), paste('Slope =', m, sep=' '), sep='\n'), size=5)
library(RODBC)
library(lubridate)
library(ggplot2)
library(scales)
library(grid)
library(gridExtra)
library(gtable)
library(devtools)
library(dateManip)
ggplot(risk.count.cos.agg, aes(x=DateGroup, y=100*CoDetectionRate, group='Co-Detection Rate', fill='Co-Detection Rate')) + geom_bar(stat='identity') + geom_line(aes(x=DateGroup, y=25*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,14), breaks=c(0, 2, 4, 6, 8, 10, 12, 14)) + scale_color_manual(values=c('red','blue','black'), name='') + scale_fill_manual(values='grey', name='') + labs(y='Co-Detection Rate (%)', x='Date')
ggplot(aes(x=DateGroup, y=25*RiskRatio, group='TCPM', color='TCPM'), data=risk.count.cos.ci.agg) + geom_line(size=2) + geom_ribbon(aes(ymin=25*LL, ymax=25*UL), alpha=0.2, data=risk.count.cos.ci.agg, color='transparent', fill='blue') + geom_line(aes(x=DateGroup, y=100*CoDetectionRate, color='Co-Detections/Total Runs', group='Co-Detections/Total Runs'), data=risk.count.cos.ci.agg, size=2) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=12, color='black'), axis.title.y=element_text(size=12), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), legend.position='bottom') + scale_x_discrete(breaks = dateBreaks, labels=dateLabels) + scale_color_manual(values=c('black','blue'), name='') + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(title='', y='Co-Detection Rate (%)', x='Date') + scale_y_continuous(limits=c(0, 16), breaks=c(0,2,4,6,8,10,12,14,16))
ggplot(aes(x=DateGroup, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=risk.count.cos.agg) + geom_line(size=2) + geom_ribbon(aes(x=DateGroup, ymin=(UniquePositives-Sdev), ymax=(UniquePositives+Sdev)), data=risk.count.cos.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Count of Unique Organisms Circulating', x='Date')
p.UniquePositives <- ggplot(aes(x=DateGroup, y=UniquePositives, group='Unique Positive Organisms', color='Unique Positive Organisms'), data=risk.count.cos.agg) + geom_line(size=2) + geom_ribbon(aes(x=DateGroup, ymin=(UniquePositives-Sdev), ymax=(UniquePositives+Sdev)), data=risk.count.cos.agg, color='transparent', fill='grey', alpha=0.5) + theme(text=element_text(size=20, face='bold'), axis.text=element_text(size=16, color='black'), axis.title.y=element_text(size=16), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='transparent', fill='white'), legend.position='bottom', panel.grid=element_blank(), axis.ticks.x=element_blank()) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,16), breaks=c(0, 2, 4, 6, 8, 10, 12, 14,16)) + scale_color_manual(values=c('black'), name='', guide=FALSE) + labs(y='Circulating Pathogen Number', x='Date')
p.UniquePositives
