as.character(unique(cp.bcid.targets.ordered[cp.bcid.targets.ordered$PositiveTargets==3, 'TargetTriggerAssay']))
assays.tri
head(cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetTriggerAssay=='Cparapsilosis', ])
subset(cp.bcid.targets, TargetTriggerAssay==assays.tri[9])
head(subset(cp.bcid.targets, TargetTriggerAssay==assays.tri[9]))
head(subset(cp.bcid.targets, TargetTriggerAssay==assays.tri[9]))
library(ggplot2)
cp.bcid.targets.ordered$YearWeek <- with(cp.bcid.targets.ordered, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
head(cp.bcid.targets.ordered)
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[9]), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(PositiveTargets))) + geom_point()
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[9]), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point()
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[9] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point()
assays.tri
paste(assays.tri[i], '_triDetectionCps.png', sep='')
paste(imgDir, assays.tri[i], '_triDetectionCps.png', sep='')
imgDir <- 'Figures/'
i <- 1
paste(imgDir, assays.tri[i], '_triDetectionCps.png', sep='')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point()
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + scale_color_manual(values=c('navyblue','blue','dodgerblue'))
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('SingleDetection','DualDetection','TriDetection'), name='Median Cp')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('SingleDetection','DualDetection','TriDetection'), name='Median Cp') + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90))
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('SingleDetection','DualDetection','TriDetection'), name='Median Cp') + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent'))
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections')) + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('SingleDetection','DualDetection','TriDetection'), name='Median Cp')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('SingleDetection','DualDetection','TriDetection'), name='Median Cp')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('First Detection','Second Detection','Third Detection'), name='Detection')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','darkgrey','grey'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + y_lim(c(0, 30)) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + y_limits(c(0, 30)) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_discrete(breaks=c(0, 5, 10, 15, 20, 25, 30)) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_discrete(breaks=c(0, 5, 10, 15, 20, 25, 30), labels=c('0','5','10','15','20','25','30')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
head(cp.bcid.targets.ordered)
class(cp.bcid.targets.ordered$TargetMedianCp)
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0, 5, 10, 15, 20, 25, 30), labels=c('0','5','10','15','20','25','30')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + y_limits(c(0, 30)) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + expand_limits(0,30) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + expand_limits(0) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + expand_limits(y=0) + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
dateBreaks <- as.character(unique(cp.bcid.targets.ordered$YearWeek))[order(as.character(unique(cp.bcid.targets.ordered$YearWeek)))][seq(1, length(as.character(unique(cp.bcid.targets.ordered$YearWeek))), 8)]
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
calendar.df$YearWeek <- with(calendar.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
min(cp.bcid.targets.ordered$YearWeek)
head(calendar.df)
calendar.df[calendar.df$Year >= startYear, ]
calendar.df[calendar.df$Year >= startYear, 'YearWeek']
unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])
unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])[order(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek']))]
unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])[order(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek']))][seq(1, length(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])), 8)]
dateBreaks <- unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])[order(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek']))][seq(1, length(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])), 8)]
ggplot(subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
dateBreaks[1]
head(calendar.df)
head(calendar.df[calendar.df$YearWeek >= dateBreaks[1], ])
unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])
data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')]))
merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), by='YearWeek')
merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), by='YearWeek', all.x=TRUE)
a <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), by='YearWeek', all.x=TRUE)
head(a)
a[is.na(a$RunDataId), c('TargetMedianCp','Index')] <- c(NA, 1)
head(a)
ggplot(a, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'TargetMedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
ggplot(temp.dat, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nColored by Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.file
for(i in 1:length(assays.tri)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.tri[i] & PositiveTargets < 4), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'TargetMedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nby Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.file <- paste(imgDir, assays.tri[i], '_triDetectionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
assays.tri
paste(imgDir, assays.dual[i], '_triDetectionCps.png', sep='')
for(i in 1:length(assays.dual)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.dual[i] & PositiveTargets < 3), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'TargetMedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nby Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.file <- paste(imgDir, assays.dual[i], '_dualDetectionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
for(i in 1:length(assays.dual)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.dual[i] & PositiveTargets < 3), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'TargetMedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.dual[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.file <- paste(imgDir, assays.dual[i], '_dualDetectionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
dev.off()
for(i in 1:length(assays.dual)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.targets.ordered, TargetTriggerAssay==assays.dual[i] & PositiveTargets < 3), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'TargetMedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=TargetMedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.dual[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
temp.file <- paste(imgDir, assays.dual[i], '_dualDetectionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
assays.tri
assays.dual
assays.dual[!(assays.dual %in% assays.tri)]
assays.single[!(assays.dual %in% assays.tri)]
setwd('~/FilmArrayTrend/CpInvestigations/')
# load the neccessary libraries
library(RODBC)
library(lubridate)
library(ggplot2)
library(devtools)
require(dateManip)
# load data from SQL
FADWcxn <- odbcConnect('FA_DW', uid = 'afaucett', pwd = 'ThisIsAPassword-BAD')
queryVector <- scan('../DataSources/SQL/AssayCpByTarget_BCID.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
cp.bcid.df <- sqlQuery(FADWcxn,query)
odbcClose(FADWcxn)
setwd('~/FilmArrayTrend/CpInvestigations/')
# load the neccessary libraries
library(RODBC)
library(lubridate)
library(ggplot2)
library(devtools)
require(dateManip)
FADWcxn <- odbcConnect('FA_DW', uid = 'afaucett', pwd = 'ThisIsAPassword-BAD')
queryVector <- scan('../DataSources/SQL/AssayCpByTarget_BCID.txt',what=character(),quote="")
query <- paste(queryVector,collapse=" ")
cp.bcid.df <- sqlQuery(FADWcxn,query)
odbcClose(FADWcxn)
runs <- unique(cp.bcid.df$RunDataId)
cp.bcid.median <- do.call(rbind, lapply(1:length(runs), function(x)
do.call(rbind, lapply(1:length(unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x], 'TargetName'])), function(y)
do.call(rbind,  lapply(1:length(unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x] & cp.bcid.df$TargetName==unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x], 'TargetName'])[y],'AssayName'])), function(z)
data.frame(RunDataId = runs[x],
TargetName = unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x], 'TargetName'])[y],
AssayName = unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x] & cp.bcid.df$TargetName==unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x], 'TargetName'])[y], 'AssayName'])[z],
MedianCp = median(cp.bcid.df[cp.bcid.df$RunDataId==runs[x] & cp.bcid.df$TargetName==unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x],'TargetName'])[y] & cp.bcid.df$AssayName==unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x] & cp.bcid.df$TargetName==unique(cp.bcid.df[cp.bcid.df$RunDataId==runs[x],'TargetName'])[y],'AssayName'])[z], 'Cp'])
)
))
))
))
View(cp.bcid.df)
# next, for each interpretation, find the minimum median Cp of all assays contributing to the interpretation
cp.bcid.targets <- do.call(rbind, lapply(1:length(runs), function(x)
do.call(rbind, lapply(1:length(unique(cp.bcid.median[cp.bcid.median$RunDataId==runs[x], 'TargetName'])), function(y)
data.frame(RunDataId = runs[x],
TargetName = unique(cp.bcid.median[cp.bcid.median$RunDataId==runs[x], 'TargetName'])[y],
TargetTriggerAssay = cp.bcid.median[cp.bcid.median$RunDataId==runs[x] & cp.bcid.median$TargetName==unique(cp.bcid.median[cp.bcid.median$RunDataId==runs[x], 'TargetName'])[y] & cp.bcid.median$MedianCp==min(cp.bcid.median[cp.bcid.median$RunDataId==runs[x] & cp.bcid.median$TargetName==unique(cp.bcid.median[cp.bcid.median$RunDataId==runs[x], 'TargetName'])[y], 'MedianCp']),'AssayName'],
TargetMedianCp = min(cp.bcid.median[cp.bcid.median$RunDataId==runs[x] & cp.bcid.median$TargetName==unique(cp.bcid.median[cp.bcid.median$RunDataId==runs[x], 'TargetName'])[y], 'MedianCp'])
)
))
))
head(cp.bcid.targets)
head(cp.bcid.df)
cp.bcid.targets.alt <- merge(cp.bcid.targets, unique(cp.bcid.df[,c('RunDataId','TargetName','PositiveAssays','PositiveGenes','Date')]), by=c('RunDataId','TargetName'))
head(cp.bcid.targets.alt)
cp.bcid.targets <- merge(cp.bcid.targets, unique(cp.bcid.df[,c('RunDataId','TargetName','PositiveAssays','PositiveGenes','Date')]), by=c('RunDataId','TargetName'))
head(cp.bcid.median)
rm(cp.bcid.targets.alt)
a <- unique(cp.bcid.median[,c('RunDataId','AssayName','MedianCp')]
a <- unique(cp.bcid.median[,c('RunDataId','AssayName','MedianCp')])
head(cp.bcid.df)
cp.bcid.assays <- merge(unique(cp.bcid.median[,c('RunDataId','AssayName','MedianCp')]), unique(cp.bcid.df[,c('RunDataId','AssayName','PositiveAssays','PositiveGenes','Date')]), by=c('RunDataId','AssayName'))
rm(a)
cp.bcid.assays <- merge(cp.bcid.assays, calendar.df[,c('Date','YearWeek')], by='Date')
startYear <- 2013
calendar.df <- createCalendarLikeMicrosoft(startYear, 'Week')
calendar.df <- transformToEpiWeeks(calendar.df)
calendar.df$YearWeek <- with(calendar.df, ifelse(Week < 10, paste(Year, Week, sep='-0'), paste(Year, Week, sep='-')))
cp.bcid.assays <- merge(cp.bcid.assays, calendar.df[,c('Date','YearWeek')], by='Date')
cp.bcid.targets <- merge(cp.bcid.targets, calendar.df[,c('Date','YearWeek')], by='Date')
head(cp.bcid.assays)
head(cp.bcid.targets)
runs.keep <- unique(cp.bcid.targets$RunDataId)
cp.bcid.targets.ordered <- do.call(rbind, lapply(1:length(runs.keep), function(x) data.frame(cp.bcid.targets[cp.bcid.targets$RunDataId==runs.keep[x], ][order(cp.bcid.targets[cp.bcid.targets$RunDataId==runs.keep[x], 'TargetMedianCp']), ], Index = seq(1, length(cp.bcid.targets[cp.bcid.targets$RunDataId==runs.keep[x], 'TargetMedianCp']), 1))))
head(cp.bcid.assays)
head(cp.bcid.assays)
head(cp.bcid.assays[with(cp.bcid.assays, order(RunDataId)), ], 50)
cp.bcid.assays.ordered <- do.call(rbind, lapply(1:length(runs.keep), function(x) data.frame(cp.bcid.assays[cp.bcid.assays$RunDataId==runs.keep[x], ][order(cp.bcid.assays[cp.bcid.assays$RunDataId==runs.keep[x], 'MedianCp']), ], Index = seq(1, length(cp.bcid.assays[cp.bcid.assays$RunDataId==runs.keep[x], 'MedianCp']), 1))))
cp.bcid.assays.ordered[cp.bcid.assays.ordered$RunDataId==873, ]
cp.bcid.assays.ordered[cp.bcid.assays.ordered$RunDataId==873, ]
head(cp.bcid.targets.ordered)
head(cp.bcid.targets.ordered)
head(cp.bcid.assays.ordered)
assays <- as.character(unique(cp.bcid.assays.ordered$AssayName))
i <- 1
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.assays.ordered, AssayName==assays[i]), by='YearWeek', all.x=TRUE)
imgDir <- 'Figures/'
dateBreaks <- unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])[order(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek']))][seq(1, length(unique(calendar.df[calendar.df$Year >= startYear, 'YearWeek'])), 8)]
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.assays.ordered, AssayName==assays[i]), by='YearWeek', all.x=TRUE)
head(temp.dat)
temp.dat[is.na(temp.dat$RunDataId), 'MedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays.tri[i],'in Trend Population\nby Order of Detection in Tests with 3 Detections', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','blue','red'), labels=c('First','Second','Third'), name='Detection Order')
head(cp.bcid.assays.ordered)
max(cp.bcid.assays.ordered$Index)
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('green4','seagreen4','seasgrean3','palegreen3','lightgreen','darkseagreen1'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('green4','seagreen4','seasgreen3','palegreen3','lightgreen','darkseagreen1'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('green4','seagreen4','seagreen3','palegreen3','lightgreen','darkseagreen1'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','grey29','grey42','grey48','grey71','grey87'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
for(i in 1:length(assays)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.assays.ordered, AssayName==assays[i]), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'MedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','grey29','grey42','grey48','grey71','grey87'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
temp.file <- paste(imgDir, assays[i], '_TimeSeriesCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
i
assays[i]
cp.bcid.assays.ordered[cp.bcid.assays.ordered$AssayName==assays[i], ]
ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','grey29','grey42','grey48','grey71','grey87'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
temp.file
grep('\\/', assays[i])
grep('/', assays[i])
assays[i]
gregexpr('\\/', assays[i])
gsub('\\/','-', assays[i])
paste(imgDir, gsub('\\/','-', assays[i]), '_TimeSeriesCps.png', sep='')
paste(imgDir, gsub('\\/','-', assays[1]), '_TimeSeriesCps.png', sep='')
dev.off()
for(i in 1:length(assays)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.assays.ordered, AssayName==assays[i]), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'MedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','grey29','grey42','grey48','grey71','grey87'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
temp.file <- paste(imgDir, gsub('\\/','-', assays[i]), '_TimeSeriesCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
i <- 1
temp.dat <- subset(cp.bcid.assays.ordered, AssayName==assays[i])
head(temp.dat)
ggplot(temp.dat, aes(x=Index, y=MedianCp)) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Year-Week')
ggplot(temp.dat, aes(x=Index, y=MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Year-Week')
ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Year-Week')
ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Order of Detection')
ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection in Tests with 2 Detections', sep=' '), y='Median Cp', x='Order of Detection')
for(i in 1:length(assays)) {
temp.dat <- subset(cp.bcid.assays.ordered, AssayName==assays[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', assays[i]), '_DistributionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
head(cp.bcid.targets.ordered)
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
ggplot(subset(cp.bcid.targets, TargetName==targets[1]), aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + facet_wrap(~TargetTriggerAssay)
ggplot(subset(cp.bcid.targets.ordered, TargetName==targets[1]), aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + facet_wrap(~TargetTriggerAssay)
i <- 1
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
ggplot(temp.dat, aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + facet_wrap(~TargetTriggerAssay) + labs(title=paste('Median Cp of Target when', assays[i],'is the Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
targets
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
for(i in 1:length(targets)) {
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + facet_wrap(~TargetTriggerAssay) + labs(title=paste('Median Cp of Target when', assays[i],'is the Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', targets[i]), '_DistributionCpsByTarget.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
for(i in 1:length(targets)) {
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + facet_wrap(~TargetTriggerAssay) + labs(title=paste('Median Cp of', targets[i],'when', assays[i],'is the Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', targets[i]), '_DistributionCpsByTarget.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
for(i in 1:length(targets)) {
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + facet_wrap(~TargetTriggerAssay) + labs(title=paste('Median Cp of', targets[i],'by','Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', targets[i]), '_DistributionCpsByTarget.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
targets
i <- 4
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','Trigger Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='Order of Detection')
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
for(i in 1:length(targets)) {
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
temp.plot <- ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
temp.file <- paste(imgDir, gsub('\\/','-', targets[i]), '_DistributionCpsByTarget.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
for(i in 1:length(assays)) {
temp.dat <- subset(cp.bcid.assays.ordered, AssayName==assays[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', assays[i]), '_DistributionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
targets
head(cp.bcid.targets.ordered)
unique(cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay'])
unique(cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay'])
i
i <- 1
unique(cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay'])
targets[i]
unique(as.character(cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay']))
targets[i]
cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay']
unique(cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay'])
a <- cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay']
unique(a)
a <- cp.bcid.targets.ordered[as.character(cp.bcid.targets$TargetName)==targets[i], 'TargetTriggerAssay']
unique(a)
cp.bcid.targets.ordered[cp.bcid.targets$TargetName==targets[i], 'TargetTriggerAssay']
cp.bcid.targets.ordered[as.character(cp.bcid.targets$TargetName)==targets[i], 'TargetTriggerAssay']
head(cp.bcid.targets.ordered)
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
head(temp.dat)
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
as.character(unique(temp.dat$TargetTriggerAssay))
for(i in 1:length(assays)) {
temp.dat <- subset(cp.bcid.assays.ordered, AssayName==assays[i])
temp.plot <- ggplot(temp.dat, aes(as.factor(Index), MedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', assays[i],'in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Order of Detection')
temp.file <- paste(imgDir, gsub('\\/','-', assays[i]), '_DistributionCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
# make a facet-wraped chart by TargetName that shows the TargetTriggerAssay and associated TargetMedianCp
targets <- as.character(unique(cp.bcid.targets.ordered$TargetName))
for(i in 1:length(targets)) {
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
if(length(as.character(unique(temp.dat$TargetTriggerAssay)))==1) {
break
} else {
temp.plot <- ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
temp.file <- paste(imgDir, gsub('\\/','-', targets[i]), '_DistributionCpsByTarget.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
}
assays <- as.character(unique(cp.bcid.assays.ordered$AssayName))
for(i in 1:length(assays)) {
temp.dat <- merge(data.frame(YearWeek = unique(calendar.df[calendar.df$YearWeek >= dateBreaks[1], c('YearWeek')])), subset(cp.bcid.assays.ordered, AssayName==assays[i]), by='YearWeek', all.x=TRUE)
temp.dat[is.na(temp.dat$RunDataId), 'MedianCp'] <- NA
temp.dat[is.na(temp.dat$RunDataId), 'Index'] <- 1
temp.plot <- ggplot(temp.dat, aes(x=YearWeek, y=MedianCp, color=as.factor(Index))) + geom_point() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=1, angle=90), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + scale_x_discrete(breaks=dateBreaks) + labs(title=paste('Median Cp of', assays[i],'Assay in Trend Population\nby Order of Detection', sep=' '), y='Median Cp', x='Year-Week') + scale_color_manual(values=c('black','grey29','grey42','grey48','grey71','grey87'), labels=c('First','Second','Third','Fourth','Fifth','Sixth'), name='Detection Order')
temp.file <- paste(imgDir, gsub('\\/','-', assays[i]), '_TimeSeriesCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
head(cp.bcid.df)
cp.bcid.df[cp.bcid.df$AssayType=='Gene', ]
head(cp.bcid.df[cp.bcid.df$AssayType=='Gene', ])
unique(cp.bcid.df[cp.bcid.df$AssayType=='Gene', 'AssayName'])
as.character(unique(cp.bcid.df[cp.bcid.df$AssayType=='Gene', 'AssayName']))
genes <-0 as.character(unique(cp.bcid.df[cp.bcid.df$AssayType=='Gene', 'AssayName']))
genes <- as.character(unique(cp.bcid.df[cp.bcid.df$AssayType=='Gene', 'AssayName']))
genes
head(cp.bcid.targets.ordered)
cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName==genes[1], ]
i <- 1
head(cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName==genes[i], ])
a <- cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName==genes[i], ]
head(a)
unique(a$TargetTriggerAssay)
do.call(rbind, lapply(1:length(runs.keep), function(x) data.frame(RunDataId = runs.keep[x], TargetMedianCpDelta = cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x], 'TargetMedianCp'] - cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x] & cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x], 'TargetTriggerAssay']==gene[1], 'TargetMedianCp'])))
do.call(rbind, lapply(1:length(runs.keep), function(x) data.frame(RunDataId = runs.keep[x], TargetMedianCpDelta = cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x], 'TargetMedianCp'] - cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x] & cp.bcid.targets.ordered[cp.bcid.targets.ordered$RunDataId==runs.keep[x], 'TargetTriggerAssay']==genes[1], 'TargetMedianCp'])))
head(a)
a <- a[with(a, order(RunDataId)), ]
head(a)
head(a, 50)
unique(a$RunDataId)
length(unique(a$RunDataId))
genes
targets
i <- 1
temp.dat <- subset(cp.bcid.targets.ordered, TargetName==targets[i])
ggplot(temp.dat, aes(TargetTriggerAssay, TargetMedianCp)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
head(cp.bcid.assays.ordered)
cp.bcid.assays.ordered[cp.bcid.assays.ordered$AssayName=='mecA', 'RunDataId']
a <- cp.bcid.assays.ordered[cp.bcid.assays.ordered$AssayName=='mecA', 'RunDataId']
head(a)
a <- cp.bcid.assays.ordered[cp.bcid.assays.ordered$AssayName=='mecA', 'RunDataId']
head(cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName=='mecA', ])
unique(cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName=='mecA', 'TargetTriggerAssay'])
unique(cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName=='mecA', 'TargetTriggerAssay'])
head(cp.bcid.median)
cp.bcid.median[cp.bcid.median==genes[i], ]
i
genes[i]
cp.bcid.median[cp.bcid.median$TargetName==genes[i], ]
a <- cp.bcid.median[cp.bcid.median$TargetName==genes[i], ]
head(a)
temp.dat <- cp.bcid.targets.ordered[cp.bcid.targets.ordered$TargetName==genes[i], ]
head(temp.dat)
temp.dat[with(temp.dat, order(RunDataId)), ]
temp.dat <- temp.dat[with(temp.dat, order(RunDataId)), ]
head(temp.dat, 50)
temp.dat <- cp.bcid.median[cp.bcid.median$TargetName==genes[i], ]
temp.dat <- temp.dat[with(temp.dat, order(RunDataId)), ]
head(temp.dat, 50)
runs.temp <- unique(temp.dat$RunDataId)
head(temp.dat)
temp.diff <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], TargetMedianCpDelta = temp.dat[temp.dat$RunDataId==runs.temp[x], 'MedianCp'] - temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
head(temp.diff)
temp.dat[temp.dat$RunDataId==849, ]
temp.diff <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName'], TargetMedianCpDelta = temp.dat[temp.dat$RunDataId==runs.temp[x], 'MedianCp'] - temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
head(temp.diff)
head(temp.dat)
head(temp.diff)
temp.mrg <- merge(temp.dat, temp.diff, by=c('RunDataId','AssayName'))
head(temp.mrg)
ggplot(temp.mrg, aes(AssayName, TargetMedianCpDetla)) + geom_boxplot()
ggplot(temp.mrg, aes(AssayName, TargetMedianCpDelta)) + geom_boxplot()
temp.diff[temp.diff$AssayName=='mecA', ]
temp.dat[temp.dat$RunDataId==377860,]
temp.diff[temp.diff$RunDataId==377860, ]
temp.diff[temp.diff$RunDataId==377860, ]
runs.temp[runs.temp==377860, ]
runs.temp[runs.temp$RunDataId==377860, ]
runs.temp
runs.temp[runs.temp==377860]
do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName'], MecACp = temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName'], MecACp = temp.dat[temp.dat$RunDataId==runs[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = 'mecA', MedianCp = temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
a <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = 'mecA', MedianCp = temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
head(a)
head(cp.bcid.median)
gene.temp <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], AssayName = 'mecA', MedianCp = temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
length(gene.temp$RunDataId)
length(unique(gene.temp$RunDataId))
head(gene.temp)
rm(diff.temp)
gene.temp <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], MedianCp = temp.dat[temp.dat$RunDataId==runs.temp[x] & temp.dat[temp.dat$RunDataId==runs.temp[x], 'AssayName']==genes[i], 'MedianCp'])))
rm(temp.diff)
head(temp.dat)
head(gene.temp)
temp.mrg <- merge(temp.dat, gene.temp, by='RunDataId')
rm(a)
head(temp.mrg)
temp.mrg$MedianCpDelta <- temp.mrg$MedianCp.x - temp.mrg$MedianCpDelta <- temp.mrg$MedianCp.y
temp.mrg$MedianCpDelta <- temp.mrg$MedianCp.x - temp.mrg$MedianCp.y
head(temp.mrg)
head(temp.mrg)
ggplot(temp.mrg, aes(AssayName, MedianCpDelta)) + geom_boxplot()
genes[i]
temp.dat[temp.dat$RunDataId==runs.temp[1] & temp.dat[temp.dat$RunDataId==runs.temp[1], 'AssayName']==genes[1], 'MedianCp']
temp.dat[temp.dat$RunDataId==runs.temp[2] & temp.dat[temp.dat$RunDataId==runs.temp[2], 'AssayName']==genes[1], 'MedianCp']
temp.dat[temp.dat$RunDataId==runs.temp[2] & as.character(temp.dat[temp.dat$RunDataId==runs.temp[2], 'AssayName'])=='mecA', ]
as.character(temp.dat[temp.dat$RunDataId==runs.temp[2], 'AssayName'])
temp.dat[as.character(temp.dat[temp.dat$RunDataId==runs.temp[2], 'AssayName'])=='mecA', ]
temp.dat[temp.dat$RunDataId==runs.temp[2], 'AssayName']
runs.temp[2]
head(temp.dat)
temp.dat[temp.dat$RunDataId==runs.temp[2], ]
subset(temp.dat[temp.dat$RunDataId==runs.temp[2], ], AssayName==genes[i])
subset(temp.dat[temp.dat$RunDataId==runs.temp[2], ], AssayName==genes[i])$MedianCp
gene.temp <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], MedianGeneCp = subset(temp.dat[temp.dat$RunDataId==runs.temp[2], ], AssayName==genes[i])$MedianCp)))
head(temp.dat, 20)
head(gene.temp)
gene.temp <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], MedianGeneCp = subset(temp.dat[temp.dat$RunDataId==runs.temp[x], ], AssayName==genes[i])$MedianCp)))
head(temp.dat, 20)
head(gene.temp)
temp.mrg <- merge(temp.dat, gene.temp, by='RunDataId')
head(temp.dat, 20)
head(temp.mrg, 20)
temp.mrg$MedianCpDelta <- temp.mrg$MedianCp - temp.mrg$MedianGeneCp
ggplot(temp.mrg, aes(AssayName, MedianCpDelta)) + geom_boxplot()
ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot()
ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of', targets[i],'by','First Assay\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of Assay - Median Cp of', gene[i], '\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + scale_y_continuous(breaks=c(0,5,10,15,20,25,30), limits=c(0,30)) + labs(title=paste('Median Cp of Assay - Median Cp of', genes[i], '\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of Assay - Median Cp of', genes[i], '\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
genes <- as.character(unique(cp.bcid.df[cp.bcid.df$AssayType=='Gene', 'AssayName']))
for(i in 1:length(genes)) {
temp.dat <- cp.bcid.median[cp.bcid.median$TargetName==genes[i], ]
runs.temp <- unique(temp.dat$RunDataId)
gene.temp <- do.call(rbind, lapply(1:length(runs.temp), function(x) data.frame(RunDataId = runs.temp[x], MedianGeneCp = subset(temp.dat[temp.dat$RunDataId==runs.temp[x], ], AssayName==genes[i])$MedianCp)))
temp.mrg <- merge(temp.dat, gene.temp, by='RunDataId')
temp.mrg$MedianCpDelta <- temp.mrg$MedianCp - temp.mrg$MedianGeneCp
temp.plot <- ggplot(subset(temp.mrg, AssayName != genes[i]), aes(AssayName, MedianCpDelta)) + geom_boxplot() + theme(plot.title=element_text(hjust=0.5), text=element_text(size=20, color='black', face='bold'), axis.text=element_text(size=18, color='black', face='bold'), axis.text.x=element_text(hjust=0.5), panel.background=element_rect(fill='white', color='transparent')) + labs(title=paste('Median Cp of Assay - Median Cp of', genes[i], '\nin Trend BCID Tests', sep=' '), y='Median Cp', x='')
temp.file <- paste(imgDir, gsub('\\/','-', genes[i]), '_DistributionDeltaCps.png', sep='')
png(temp.file, width = 1400, height = 800)
print(temp.plot)
dev.off()
}
