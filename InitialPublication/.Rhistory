ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(ShortName, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=ShortName, group=ShortName, order=ShortName), stat='identity', position='stack') + scale_fill_manual(values=bug.individual.Pal, name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.8), labels=c(0, 10, 20, 30, 40, 50, 60, 70, 80), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='', y='Detection (%)', x='Date')
head(prevalence.nat.individual.wrap)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(ShortName, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=ShortName, order=ShortName), stat='identity', position='stack') + scale_fill_manual(values=bug.individual.Pal, name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.8), labels=c(0, 10, 20, 30, 40, 50, 60, 70, 80), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.8), labels=c(0, 10, 20, 30, 40, 50, 60, 70, 80), breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.8), labels='percent', breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.8), label='percent', breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label='percent') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
ggplot(subset(ili.burn.nat, as.character(YearWeek) > '2013-26'), aes(x=YearWeek, y=Rate, color='CDC ILI', group='CDC ILI')) + geom_line(lwd=1.5) + scale_color_manual(values=c('black','red'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.05), breaks=c(0, 0.01, 0.02, 0.03, 0.04, 0.05), labels=c('0','1','2','3','4','5')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, face='bold', color='black'), axis.text.x=element_text(angle=90, hjust=1), axis.ticks.x=element_blank(), panel.background=element_rect(fill='white', color='white'), legend.position = 'bottom') + labs(x='Date', y='ILI (%)')
ggplot(subset(ili.burn.nat, as.character(YearWeek) > '2013-26'), aes(x=YearWeek, y=Rate, color='CDC ILI', group='CDC ILI')) + geom_line(lwd=1.5) + scale_color_manual(values=c('black','red'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0,0.05), breaks=c(0, 0.01, 0.02, 0.03, 0.04, 0.05), labels=c('0','1','2','3','4','5')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, face='bold', color='black'), axis.text.x=element_text(angle=90, hjust=1), axis.ticks.x=element_blank(), panel.background=element_rect(fill='white', color='white'), legend.position = 'bottom') + labs(y='ILI Prevalence (CDC)')
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date')
head(prevalence.nat.individual.wrap)
head(ili.burn.nat)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=Rate), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)))
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)))
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=10*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=20*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), legend.position='bottom', panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + guides(fill=guide_legend(ncol=7, bycol=TRUE)) + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())  + labs(title='National Percent Detection of Organism in Trend Population', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())  + labs(title='National Percent Detection of Organisms with ILI Overlay', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
head(ili.burn.nat)
max(ili.burn.nat$Rate*15)
max(ili.burn.nat$Rate*15, na.omit=TRUE)
max(ili.burn.nat$Rate*15, na.action='omit')
ili.burn.nat$Rate*15
max(ili.burn.nat$Rate*15, na.rm = TRUE)
ggplot(subset(ili.burn.nat,YearWeek %in% prevalence.nat.individual.wrap$YearWeek), aes(x=YearWeek, y=15*Rate, group='Reported ILI', color='Reported ILI')) + geom_line(lwd=1.5, color='black') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0, 0.8), breaks=c(0.0, 0.2, 0.4, 0.6, 0.8), labels=c('1%','2%','3%','4%','5%')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI Prevalence (CDC)')
p1 <- ggplot(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())  + labs(title='National Percent Detection of Organisms with ILI Overlay', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
p2 <- ggplot(subset(ili.burn.nat,YearWeek %in% prevalence.nat.individual.wrap$YearWeek), aes(x=YearWeek, y=15*Rate, group='Reported ILI', color='Reported ILI')) + geom_line(lwd=1.5, color='black') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0, 0.8), breaks=c(0.0, 0.2, 0.4, 0.6, 0.8), labels=c('1%','2%','3%','4%','5%')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI Prevalence (CDC)')
# Get the ggplot grobs
g1 <- ggplotGrob(p1)
g2 <- ggplotGrob(p2)
# Get the location of the plot panel in g1.
# These are used later when transformed elements of g2 are put back into g1
pp <- c(subset(g1$layout, name == "panel", se = t:r))
# Overlap panel for second plot on that of the first plot
g1 <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == "panel")]], pp$t, pp$l, pp$b, pp$l)
# Get the y axis title from g2
# index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
ylab <- g2$grobs[[index]]                # Extract that grob
ylab <- hinvert_title_grob(ylab)         # Swap margins and fix justifications
# Put the transformed label on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
g1 <- gtable_add_grob(g1, ylab, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "ylab-r")
# Get the y axis from g2 (axis line, tick marks, and tick mark labels)
index <- which(g2$layout$name == "axis-l")  # Which grob
yaxis <- g2$grobs[[index]]                  # Extract the grob
# yaxis is a complex of grobs containing the axis line, the tick marks, and the tick mark labels.
# The relevant grobs are contained in axis$children:
#   axis$children[[1]] contains the axis line;
#   axis$children[[2]] contains the tick marks and tick mark labels.
# First, move the axis line to the left
yaxis$children[[1]]$x <- unit.c(unit(0, "npc"), unit(0, "npc"))
# Second, swap tick marks and tick mark labels
ticks <- yaxis$children[[2]]
ticks$widths <- rev(ticks$widths)
ticks$grobs <- rev(ticks$grobs)
# Third, move the tick marks
ticks$grobs[[1]]$x <- ticks$grobs[[1]]$x - unit(1, "npc") + unit(3, "pt")
# Fourth, swap margins and fix justifications for the tick mark labels
ticks$grobs[[2]] <- hinvert_title_grob(ticks$grobs[[2]])
# Fifth, put ticks back into yaxis
yaxis$children[[2]] <- ticks
# Put the transformed yaxis on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
yarema.all <- gtable_add_grob(g1, yaxis, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "axis-r")
grid.newpage()
grid.draw(yarema.all)
max(ili.burn.nat$Rate, na.rm=TRUE)
grid.newpage()
png('Figures/Yarema_All.png', height=800, width=1400)
grid.draw(yarema.all)
dev.off()
head(prevalence.nat.individual.wrap)
unique(prevalence.nat.individual.wrap$Bug)
unique(prevalence.nat.individual.wrap$Name)
unique(prevalence.nat.individual.wrap$ShortName)
ggplot(subset(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], as.character(ShortName)!='HRV/EV' ), aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())  + labs(title='National Percent Detection of Organisms with ILI Overlay', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
p1 <- ggplot(subset(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(Bug, decreasing=TRUE)),], as.character(ShortName)!='HRV/EV' ), aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=Bug, group=Bug), stat='identity', position='stack') + scale_fill_manual(values=createPaletteOfVariableLength(prevalence.nat.individual.wrap, 'Bug'), name='') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(label=percent, limits=c(0,0.8)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())  + labs(title='National Percent Detection of Organisms with ILI Overlay', y='Percent Detection', x='Date') + geom_line(aes(x=YearWeek, y=15*Rate, group='Reported ILI'), data=subset(ili.burn.nat, YearWeek %in% unique(prevalence.nat.individual.wrap$YearWeek)), color='black', lwd=1.5)
p2 <- ggplot(subset(ili.burn.nat,YearWeek %in% prevalence.nat.individual.wrap$YearWeek), aes(x=YearWeek, y=15*Rate, group='Reported ILI', color='Reported ILI')) + geom_line(lwd=1.5, color='black') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + scale_y_continuous(limits=c(0, 0.8), breaks=c(0.0, 0.2, 0.4, 0.6, 0.8), labels=c('1%','2%','3%','4%','5%')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI Prevalence (CDC)')
# Get the ggplot grobs
g1 <- ggplotGrob(p1)
g2 <- ggplotGrob(p2)
# Get the location of the plot panel in g1.
# These are used later when transformed elements of g2 are put back into g1
pp <- c(subset(g1$layout, name == "panel", se = t:r))
# Overlap panel for second plot on that of the first plot
g1 <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == "panel")]], pp$t, pp$l, pp$b, pp$l)
# Get the y axis title from g2
# index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
ylab <- g2$grobs[[index]]                # Extract that grob
ylab <- hinvert_title_grob(ylab)         # Swap margins and fix justifications
# Put the transformed label on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
g1 <- gtable_add_grob(g1, ylab, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "ylab-r")
# Get the y axis from g2 (axis line, tick marks, and tick mark labels)
index <- which(g2$layout$name == "axis-l")  # Which grob
yaxis <- g2$grobs[[index]]                  # Extract the grob
# yaxis is a complex of grobs containing the axis line, the tick marks, and the tick mark labels.
# The relevant grobs are contained in axis$children:
#   axis$children[[1]] contains the axis line;
#   axis$children[[2]] contains the tick marks and tick mark labels.
# First, move the axis line to the left
yaxis$children[[1]]$x <- unit.c(unit(0, "npc"), unit(0, "npc"))
# Second, swap tick marks and tick mark labels
ticks <- yaxis$children[[2]]
ticks$widths <- rev(ticks$widths)
ticks$grobs <- rev(ticks$grobs)
# Third, move the tick marks
ticks$grobs[[1]]$x <- ticks$grobs[[1]]$x - unit(1, "npc") + unit(3, "pt")
# Fourth, swap margins and fix justifications for the tick mark labels
ticks$grobs[[2]] <- hinvert_title_grob(ticks$grobs[[2]])
# Fifth, put ticks back into yaxis
yaxis$children[[2]] <- ticks
# Put the transformed yaxis on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
yarema.all <- gtable_add_grob(g1, yaxis, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "axis-r")
# Draw it
grid.newpage()
png('Figures/Yarema_Subset.png', height=800, width=1400)
grid.draw(yarema.all)
dev.off()
head(prevalence.reg.agg)
head(runs.df)
head(bugs.df)
runs.df[!(runs.df$RunDataId %in% bugs.df$RunDataId), ]
negatives.df <- runs.df[!(runs.df$RunDataId %in% bugs.df$RunDataId), ]
head(negatives.df)
head(runs.reg.roll)
negatives.agg <- with(data.frame(negatives.df, Negatives = 1), aggregate(Negatives~YearWeek+CustomerSiteId, FUN=sum))
merge(negatives.df, calendar.df[,c('Date','YearWeek')], by='Date', all.x=TRUE)
head(runs.reg.roll)
negatives.df <- merge(negatives.df, calendar.df[,c('Date','YearWeek')], by='Date')
negatives.agg <- with(data.frame(negatives.df, Negatives = 1), aggregate(Negatives~YearWeek+CustomerSiteId, FUN=sum))
head(negatives.agg)
sites
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(calendar.df[,c('YearWeek')]), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))))
head(calendar.df)
head(negatives.agg)
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(YearWeek = calendar.df$YearWeek), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))))
head(negatives.fill)
negatives.fill[is.na(negatives.fill$Negatives), ]
negatives.fill[is.na(negatives.fill$Negatives), 'Negatives'] <- 0
head(negatives.fill)
View(negatives.fill)
negatives.agg[negatives.agg$CustomerSiteId==2, ]
merge(data.frame(YearWeek = calendar.df$YearWeek), negatives.agg[negatives.agg$CustomerSiteId==sites[1], ], by='YearWeek', all.x=TRUE)
merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[1], ], by='YearWeek', all.x=TRUE)
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))))
negatives.fill[is.na(negatives.fill$Negatives), 'Negatives'] <- 0
head(negatives.fill)
as.character(unique(negatives.fill$YearWeek))[order(as.character(unique(negatives.fill$YearWeek)))]
neg.periods <- as.character(unique(negatives.fill$YearWeek))[order(as.character(unique(negatives.fill$YearWeek)))]
head(negatives.fill)
do.call(rbind, lapply(1:length(site), function(x) do.call(rbind, lapply(2:(length(neg.periods)-1), function(y) data.frame(YearWeek = neg.periods[y], CustomerSiteId = sites[x], Negatives = sum(negatives.fill[negatives.fill$CustomerSiteId==sites[x], 'Negatives'][(y-1):(y+1)]))))))
negatives.roll <- do.call(rbind, lapply(1:length(site), function(x) do.call(rbind, lapply(2:(length(neg.periods)-1), function(y) data.frame(YearWeek = neg.periods[y], CustomerSiteId = sites[x], Negatives = sum(negatives.fill[negatives.fill$CustomerSiteId==sites[x], 'Negatives'][(y-1):(y+1)]))))))
head(negatives.fill)
head(negatives.roll)
12+12+18
12+18+14
head(runs.reg.roll)
head(negatives.roll)
negatives.prev <- merge(runs.reg.roll, negatives.roll, by=c('YearWeek','CustomerSiteId'))
head(negatives.prev)
head(ili.burn.nat)
head(runs.reg.norm)
head(runs.reg.norm)
head(negatives.prev)
negatives.prev$NegRate <- with(negatives.prev, Negatives/Runs)
head(negatives.prev)
head(runs.reg.norm)
neg.burn.df <- merge(runs.reg.norm[,c('YearWeek','CustomerSiteId','NormalizedBurn')], negatives.prev, by=c('YearWeek','CustomerSiteId'))
head(neg.burn.df)
with(neg.burn.df, NegRate*NormalizedBurn)
unique(neg.burn.df$YearWeek)
unique(neg.burn.df$CustomerSiteId)
site
sites
negatives.roll <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(2:(length(neg.periods)-1), function(y) data.frame(YearWeek = neg.periods[y], CustomerSiteId = sites[x], Negatives = sum(negatives.fill[negatives.fill$CustomerSiteId==sites[x], 'Negatives'][(y-1):(y+1)]))))))
negatives.prev <- merge(runs.reg.roll, negatives.roll, by=c('YearWeek','CustomerSiteId'))
negatives.prev$NegRate <- with(negatives.prev, Negatives/Runs)
neg.burn.df <- merge(runs.reg.norm[,c('YearWeek','CustomerSiteId','NormalizedBurn')], negatives.prev, by=c('YearWeek','CustomerSiteId'))
head(neg.burn.df)
head(negatives.fill)
negatives.fill[is.na(negatives.fill$Negatives), ]
head(negatives.prev)
head(negatives.fill)
head(negatives.prev)
negatives.fill[negatives.fill$CustomerSiteId==26 & negatives.fill$YearWeek=='2013-01', ]
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))))
negatives.fill[negatives.fill$CustomerSiteId==26 & negatives.fill$YearWeek=='2013-01', ]
data.frame(YearWeek = unique(calendar.df$YearWeek))
negatives.agg[negatives.agg$CustomerSiteId==sites[1], ]
data.frame(merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[1], ], by='YearWeek', all.x=TRUE)
dmerge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[1], ], by='YearWeek', all.x=TRUE)
merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[1], ], by='YearWeek', all.x=TRUE)
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE)))
negatives.fill[negatives.fill$CustomerSiteId==26 & negatives.fill$YearWeek=='2013-01', ]
sites
merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[8], ], by='YearWeek', all.x=TRUE)
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE)))
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE)))
negatives.fill[negatives.fill$CustomerSiteId==26 & negatives.fill$YearWeek=='2013-01', ]
merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[8], ], by='YearWeek', all.x=TRUE)
lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))
lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))[[1]]
lapply(1:length(sites), function(x) merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], ], by='YearWeek', all.x=TRUE))[[13]]
do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], c('YearWeek','Negatives')], by='YearWeek', all.x=TRUE), CustomerSiteId = sites[x])))
negatives.fill <- do.call(rbind, lapply(1:length(sites), function(x) data.frame(merge(data.frame(YearWeek = unique(calendar.df$YearWeek)), negatives.agg[negatives.agg$CustomerSiteId==sites[x], c('YearWeek','Negatives')], by='YearWeek', all.x=TRUE), CustomerSiteId = sites[x])))
negatives.fill[negatives.fill$CustomerSiteId==26 & negatives.fill$YearWeek=='2013-01', ]
negatives.fill[is.na(negatives.fill$Negatives), ]
negatives.fill[is.na(negatives.fill$Negatives), 'Negatives'] <- 0
head(negatives.fill)
neg.periods <- as.character(unique(negatives.fill$YearWeek))[order(as.character(unique(negatives.fill$YearWeek)))]
negatives.roll <- do.call(rbind, lapply(1:length(sites), function(x) do.call(rbind, lapply(2:(length(neg.periods)-1), function(y) data.frame(YearWeek = neg.periods[y], CustomerSiteId = sites[x], Negatives = sum(negatives.fill[negatives.fill$CustomerSiteId==sites[x], 'Negatives'][(y-1):(y+1)]))))))
negatives.roll[is.na(negatives.roll$Negatives), 'Negatives'] <- 0
negatives.prev <- merge(runs.reg.roll, negatives.roll, by=c('YearWeek','CustomerSiteId'))
negatives.prev$NegRate <- with(negatives.prev, Negatives/Runs)
neg.burn.df <- merge(runs.reg.norm[,c('YearWeek','CustomerSiteId','NormalizedBurn')], negatives.prev, by=c('YearWeek','CustomerSiteId'))
head(negatives.prev)
negatives.prev[negatives.prev$CustomerSiteId==26, ]
negatives.agg[negatives.agg$CustomerSiteId==26, ]
negatives.agg[negatives.agg$CustomerSiteId==25, ]
head(negatives.prev)
neg.burn.df <- merge(runs.reg.norm[,c('YearWeek','CustomerSiteId','NormalizedBurn')], negatives.prev, by=c('YearWeek','CustomerSiteId'))
View(neg.burn.df)
neg.burn.df <- neg.burn.df[with(neg.burn.df, order(CustomerSiteId, YearWeek)), ]
head(neg.burn.df)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=100*NegRate, group='NegRate'), color='red', data=neg.burn.df)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=100*NegRate, group='NegRate'), color='red', data=neg.burn.df) + facet_wrap(~CustomerSiteId)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate'), color='red', data=neg.burn.df) + facet_wrap(~CustomerSiteId)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn*NegRate, group='Negative Rate factored by TURN')) + geom_line()
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn*NegRate, group='Negative Rate factored by TURN')) + geom_line() + facet_wrap(~CustomerSideId)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn*NegRate, group='Negative Rate factored by TURN')) + geom_line() + facet_wrap(~CustomerSiteId)
head(neg.burn.df)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'))
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=100*NegRate, group='NegRate'), color='red', data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_x_discrete(breaks=dateBreaks)
dateBreaks
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=100*NegRate, group='NegRate'), color='red', data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_x_discrete(breaks=dateBreaks, labels=dateLabels) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'))
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line() + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank())
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate')
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date')
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=0.5, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
dateLabels
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
head(neg.burn.df)
neg.burn.df$TURNByNegs <- with(neg.burn.df, NegRate*NormalizedBurn)
head(neg.burn.df)
head(neg.burn.df)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + facet_wrap(~CustomerSiteId) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + facet_wrap(~CustomerSiteId) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
head(neg.burn.df)
with(neg.burn.df, aggregate(cbind(NegRate, NormalizedBurn, TURNByNegs)~YearWeek, FUN=mean))
neg.burn.nat <- with(neg.burn.df, aggregate(cbind(NegRate, NormalizedBurn, TURNByNegs)~YearWeek, FUN=mean))
head(neg.burn.nat)
ggplot(neg.burn.nat, aes(x=YearWeek, y=TURNBYNegs)) + geom_point()
ggplot(neg.burn.nat, aes(x=YearWeek, y=TURNByNegs)) + geom_point()
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + facet_wrap(~CustomerSiteId) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_point(color='black') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
ggplot(neg.burn.nat, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
p.NegativesAndTURNBySite <- ggplot(neg.burn.df, aes(x=YearWeek, y=NormalizedBurn, group='TURN', color='TURN')) + geom_line(lwd=1.5) + geom_line(aes(x=YearWeek, y=10*NegRate, group='NegRate', color='NegRate'), lwd=1.5, data=neg.burn.df) + facet_wrap(~CustomerSiteId) + scale_color_manual(values=c('black','red'), name='') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN, 10*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
p.NegativesFactoredByTURNBySite <- ggplot(neg.burn.df, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + facet_wrap(~CustomerSiteId) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
p.NegativesFactoredByTURN <- ggplot(neg.burn.nat, aes(x=YearWeek, y=TURNByNegs, group='TURN Factored by Negative Test Rate')) + geom_line(color='black', lwd=1.5) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1, vjust=0.5), panel.background=element_rect(color='white', fill='white'), axis.ticks.x=element_blank()) + labs(y='TURN*NegRate', x='Date') + scale_x_discrete(breaks=dateBreaks, labels=dateLabels)
plots <- ls()[grep('^p\\.',ls())]
for(i in 1:length(plots)) {
imgName <- paste(substring(plots[i],3),'.png',sep='')
png(file=paste('Figures', imgName, sep='/'), width=1200, height=800, units='px')
print(eval(parse(text = plots[i])))
dev.off()
}
library(RODBC)
library(lubridate)
library(EpiWeek)
library(ggplot2)
library(grid)
library(gridExtra)
library(scales)
library(gtable)
library(RColorBrewer)
library(devtools)
library(RCurl)
library(binom)
library(caret)
library(rpart)
library(party)
library(partykit)
library(randomForest)
require(dateManip)
# load custom functions
source('../Rfunctions/normalizeBurnRate.R')
source('~/WebHub/AnalyticsWebHub/Rfunctions/createPaletteOfVariableLength.R')
head(cdc.bfdx.flu.nat)
p1 <- ggplot(cdc.bfdx.flu.nat, aes(x=YearWeek, y=FluPercentDetection, group='FilmArrary Detection', color='FilmArray Detection')) + geom_line(size=2) + geom_line(aes(x=YearWeek, y=FluPrevalence, group='CDC Flu Prevalence', color='CDC Flu Prevalence'), cdc.bfdx.flu.nat, lwd=1.5)  + geom_line(aes(x=YearWeek, y=10*Rate, group='CDC ILI Rate', color='CDC ILI Rate'), cdc.bfdx.flu.nat, lwd=1.5) + geom_line(aes(x=YearWeek, y=NormalizedBurn/10, group='FilmArray Utilization', color='FilmArray Utilization'), cdc.bfdx.flu.nat, lwd=1.5) + scale_color_manual(values=c('black','blue','red','darkgreen'), name='') + scale_y_continuous(breaks=c(0,.07,0.14,0.21,0.28,0.35), limits=c(0,0.35), labels=c(0, 7, 14, 21, 28, 35)) + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection (%), Flu Prevalence (%)', x='Date')
p2 <- ggplot(cdc.bfdx.flu.nat, aes(x=YearWeek)) + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + scale_y_continuous(limits=c(0,0.35), breaks=c(0, 0.07, 0.14, 0.21, 0.28, 0.35), labels=c('0.0','0.7','1.4','2.1','2.8','3.5')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI (%), FilmArray Utilization')
# Get the ggplot grobs
g1 <- ggplotGrob(p1)
g2 <- ggplotGrob(p2)
# Get the location of the plot panel in g1.
# These are used later when transformed elements of g2 are put back into g1
pp <- c(subset(g1$layout, name == "panel", se = t:r))
# Overlap panel for second plot on that of the first plot
g1 <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == "panel")]], pp$t, pp$l, pp$b, pp$l)
# Get the y axis title from g2
index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
ylab <- g2$grobs[[index]]                # Extract that grob
ylab <- hinvert_title_grob(ylab)         # Swap margins and fix justifications
# Put the transformed label on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
g1 <- gtable_add_grob(g1, ylab, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "ylab-r")
# Get the y axis from g2 (axis line, tick marks, and tick mark labels)
index <- which(g2$layout$name == "axis-l")  # Which grob
yaxis <- g2$grobs[[index]]                  # Extract the grob
# yaxis is a complex of grobs containing the axis line, the tick marks, and the tick mark labels.
# The relevant grobs are contained in axis$children:
#   axis$children[[1]] contains the axis line;
#   axis$children[[2]] contains the tick marks and tick mark labels.
# First, move the axis line to the left
yaxis$children[[1]]$x <- unit.c(unit(0, "npc"), unit(0, "npc"))
# Second, swap tick marks and tick mark labels
ticks <- yaxis$children[[2]]
ticks$widths <- rev(ticks$widths)
ticks$grobs <- rev(ticks$grobs)
# Third, move the tick marks
ticks$grobs[[1]]$x <- ticks$grobs[[1]]$x - unit(1, "npc") + unit(3, "pt")
# Fourth, swap margins and fix justifications for the tick mark labels
ticks$grobs[[2]] <- hinvert_title_grob(ticks$grobs[[2]])
# Fifth, put ticks back into yaxis
yaxis$children[[2]] <- ticks
# Put the transformed yaxis on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
fluTriple <- gtable_add_grob(g1, yaxis, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "axis-r")
# Draw it
grid.newpage()
png('Figures/InfluenzaPrevalencePercentDetectionBurnAndILI.png', height=800, width=1400)
grid.draw(fluTriple)
dev.off()
head(prevalence.reg.count)
decoder
fluAs
bfdx.flu.reg <- with(prevalence.reg.count, aggregate(cbind(Runs, j, k, l, m, n)~YearWeek+Region+CustomerSiteId, FUN=sum))
bfdx.flu.reg$FluDetections <- with(bfdx.flu.reg, j+k+l+m+n+o)
# CDC - Clinical Labs (only has data from 2015+)
cdc.flu.reg <- read.csv('../DataSources/RegionalInfluenzaByType.csv', header=TRUE, sep=',')
cdc.flu.reg <- data.frame(YearWeek = with(cdc.flu.reg, ifelse(WEEK < 10, paste(YEAR, WEEK, sep='-0'), paste(YEAR, WEEK, sep='-'))), Region = cdc.flu.reg$REGION, TotalPatients = cdc.flu.reg$TOTAL.SPECIMENS, TotalFluObservations = cdc.flu.reg$TOTAL.A + cdc.flu.reg$TOTAL.B)
cdc.flu.reg <- do.call(rbind, lapply(1:length(unique(cdc.flu.reg$Region)), function(x) data.frame(YearWeek = cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'YearWeek'][2:(length(cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'YearWeek'])-1)], Region = unique(cdc.flu.reg$Region)[x], TotalPatients = sapply(2:(length(cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'YearWeek'])-1), function(y) sum(cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'TotalPatients'][(y-1):(y+1)])), TotalFluObservations = sapply(2:(length(cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'YearWeek'])-1), function(y) sum(cdc.flu.reg[cdc.flu.reg$Region == unique(cdc.flu.reg$Region)[x],'TotalFluObservations'][(y-1):(y+1)])))))
# # CDC - Public Health labs (2015+) and data from both Public Health and Clinical labs prior to 2015
# cdc.flu.sub.reg <- read.csv('../../DataSources/RegionalInfluenzaBySubType.csv', header=TRUE, sep=',')
# cdc.flu.sub.reg.prior <- read.csv('../../DataSources/RegionalInfluenzaBySubType_PriorYears.csv', header=TRUE, sep=',')
# cdc.flu.sub.reg <- data.frame(YearWeek = with(cdc.flu.sub.reg, ifelse(WEEK < 10, paste(YEAR, WEEK, sep='-0'), paste(YEAR, WEEK, sep='-'))), Region = cdc.flu.sub.reg$REGION, TotalPatients = cdc.flu.sub.reg$TOTAL.SPECIMENS, TotalFluObservations = cdc.flu.sub.reg$A..H3.+cdc.flu.sub.reg$A..2009.H1N1.+cdc.flu.sub.reg$A..Subtyping.not.Performed.+cdc.flu.sub.reg$B+cdc.flu.sub.reg$BVic+cdc.flu.sub.reg$BYam+cdc.flu.sub.reg$H3N2v)
# cdc.flu.sub.reg.prior <- data.frame(YearWeek = with(cdc.flu.sub.reg.prior, ifelse(WEEK < 10, paste(YEAR, WEEK, sep='-0'), paste(YEAR, WEEK, sep='-'))), Region = cdc.flu.sub.reg.prior$REGION, TotalPatients = cdc.flu.sub.reg.prior$TOTAL.SPECIMENS, TotalFluObservations = cdc.flu.sub.reg.prior$A..H3.+cdc.flu.sub.reg.prior$A..2009.H1N1.+cdc.flu.sub.reg.prior$A..H1.+cdc.flu.sub.reg.prior$A..Subtyping.not.Performed.+cdc.flu.sub.reg.prior$B+cdc.flu.sub.reg.prior$H3N2v+cdc.flu.sub.reg.prior$A..Unable.to.Subtype.)
cdc.bfdx.flu.reg <- merge(cdc.flu.reg, bfdx.flu.reg, by=c('YearWeek','Region'))[ ,c('YearWeek','Region','TotalPatients','TotalFluObservations','Runs','FluDetections')]
cdc.bfdx.flu.reg$FluPrevalence <- with(cdc.bfdx.flu.reg, TotalFluObservations/TotalPatients)
cdc.bfdx.flu.reg$FluPercentDetection <- with(cdc.bfdx.flu.reg, FluDetections/Runs)
cdc.bfdx.flu.nat <- with(cdc.bfdx.flu.reg, aggregate(cbind(FluPrevalence, FluPercentDetection)~YearWeek, FUN=mean))
cdc.bfdx.flu.nat <- merge(cdc.bfdx.flu.nat, unique(prevalence.nat.individual.wrap[,c('YearWeek','Rate')]), by='YearWeek')
cdc.bfdx.flu.nat <- merge(cdc.bfdx.flu.nat, ili.burn.nat[,c('YearWeek','NormalizedBurn')], by='YearWeek')
dateBreaksAlt2 <- c('2015-41','2016-01','2016-14','2016-27','2016-40','2016-52')
dateLabelsAlt2 <- c('-','Jan-2016','-','Jul-2016','-','Jan-2017')
# p1 <- ggplot(cdc.bfdx.flu.nat, aes(x=YearWeek, y=FluPercentDetection, group='Percent Detection', fill='FilmArray Detection')) + geom_bar(stat='identity') + scale_fill_manual(values=createPaletteOfVariableLength(data.frame(Name=c('FilmArray Detection')), 'Name'), name='') + geom_line(aes(x=YearWeek, y=FluPrevalence, group='CDC Flu Prevalence', color='CDC Flu Prevalence'), cdc.bfdx.flu.nat, lwd=1.5)  + geom_line(aes(x=YearWeek, y=10*Rate, group='CDC ILI Rate', color='CDC ILI Rate'), cdc.bfdx.flu.nat, lwd=1.5) + scale_color_manual(values=c('black','blue'), name='') + scale_y_continuous(breaks=c(0,.07,0.14,0.21,0.28,0.35), limits=c(0,0.35), labels=c(0, 7, 14, 21, 28, 35)) + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection (%), CDC Flu Prevalence (%)', x='Date')
p1 <- ggplot(cdc.bfdx.flu.nat, aes(x=YearWeek, y=FluPercentDetection, group='FilmArrary Detection', color='FilmArray Detection')) + geom_line(size=2) + geom_line(aes(x=YearWeek, y=FluPrevalence, group='CDC Flu Prevalence', color='CDC Flu Prevalence'), cdc.bfdx.flu.nat, lwd=1.5)  + geom_line(aes(x=YearWeek, y=10*Rate, group='CDC ILI Rate', color='CDC ILI Rate'), cdc.bfdx.flu.nat, lwd=1.5) + geom_line(aes(x=YearWeek, y=NormalizedBurn/10, group='FilmArray Utilization', color='FilmArray Utilization'), cdc.bfdx.flu.nat, lwd=1.5) + scale_color_manual(values=c('black','blue','red','darkgreen'), name='') + scale_y_continuous(breaks=c(0,.07,0.14,0.21,0.28,0.35), limits=c(0,0.35), labels=c(0, 7, 14, 21, 28, 35)) + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection (%), Flu Prevalence (%)', x='Date')
p2 <- ggplot(cdc.bfdx.flu.nat, aes(x=YearWeek)) + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + scale_y_continuous(limits=c(0,0.35), breaks=c(0, 0.07, 0.14, 0.21, 0.28, 0.35), labels=c('0.0','0.7','1.4','2.1','2.8','3.5')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI (%), FilmArray Utilization')
# Get the ggplot grobs
g1 <- ggplotGrob(p1)
g2 <- ggplotGrob(p2)
# Get the location of the plot panel in g1.
# These are used later when transformed elements of g2 are put back into g1
pp <- c(subset(g1$layout, name == "panel", se = t:r))
# Overlap panel for second plot on that of the first plot
g1 <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == "panel")]], pp$t, pp$l, pp$b, pp$l)
# Get the y axis title from g2
index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
ylab <- g2$grobs[[index]]                # Extract that grob
ylab <- hinvert_title_grob(ylab)         # Swap margins and fix justifications
# Put the transformed label on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
g1 <- gtable_add_grob(g1, ylab, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "ylab-r")
# Get the y axis from g2 (axis line, tick marks, and tick mark labels)
index <- which(g2$layout$name == "axis-l")  # Which grob
yaxis <- g2$grobs[[index]]                  # Extract the grob
# yaxis is a complex of grobs containing the axis line, the tick marks, and the tick mark labels.
# The relevant grobs are contained in axis$children:
#   axis$children[[1]] contains the axis line;
#   axis$children[[2]] contains the tick marks and tick mark labels.
# First, move the axis line to the left
yaxis$children[[1]]$x <- unit.c(unit(0, "npc"), unit(0, "npc"))
# Second, swap tick marks and tick mark labels
ticks <- yaxis$children[[2]]
ticks$widths <- rev(ticks$widths)
ticks$grobs <- rev(ticks$grobs)
# Third, move the tick marks
ticks$grobs[[1]]$x <- ticks$grobs[[1]]$x - unit(1, "npc") + unit(3, "pt")
# Fourth, swap margins and fix justifications for the tick mark labels
ticks$grobs[[2]] <- hinvert_title_grob(ticks$grobs[[2]])
# Fifth, put ticks back into yaxis
yaxis$children[[2]] <- ticks
# Put the transformed yaxis on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
fluTriple <- gtable_add_grob(g1, yaxis, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "axis-r")
# Draw it
grid.newpage()
png('Figures/InfluenzaPrevalencePercentDetectionBurnAndILI.png', height=800, width=1400)
grid.draw(fluTriple)
dev.off()
# make time series percent detection by organism family with ILI and Normalized Utilization Overlays
prevalence.nat.individual.wrap <- prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(ShortName, YearWeek)), ]
head(prevalence.nat.individual.wrap)
p1 <- ggplot(subset(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(ShortName, decreasing=TRUE)),], Bug %in% fluAs), aes(x=YearWeek)) + geom_area(aes(y=Prevalence, fill=ShortName, group=ShortName, order=ShortName), stat='identity', position='stack') + scale_fill_manual(values=bug.individual.Pal, name='') + scale_x_discrete(breaks = dateBreaks, labels = dateLabels) + scale_y_continuous(limits=c(0, 0.25), breaks=c(0, 0.05, 0.10, 0.15, 0.2, 0.25), labels=c(0, 5, 10, 15, 20, 25)) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='Detection (%)', x='Date')
p2 <- ggplot(subset(prevalence.nat.individual.wrap[with(prevalence.nat.individual.wrap, order(ShortName, decreasing=TRUE)),], Bug %in% fluAs), aes(x=YearWeek, y=5*Rate, group=1)) + geom_line(color='black', lwd=2) + geom_line(aes(x=YearWeek, y=5*NormalizedBurn/100, group=2), subset(ili.burn.nat, as.character(ili.burn.nat$YearWeek) >='2013-26'), color='red', lwd=2) + scale_x_discrete(breaks = dateBreaks, labels = dateLabels) + scale_y_continuous(limits=c(0, 0.25), breaks=c(0, 0.05, 0.10, 0.15, 0.2, 0.25), labels=c('0','1','2','3','4','5')) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(fill='transparent', color='transparent'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='ILI (black, %), FilmArray Utilization (red)')
# Get the ggplot grobs
g1 <- ggplotGrob(p1)
g2 <- ggplotGrob(p2)
# Get the location of the plot panel in g1.
# These are used later when transformed elements of g2 are put back into g1
pp <- c(subset(g1$layout, name == "panel", se = t:r))
# Overlap panel for second plot on that of the first plot
g1 <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == "panel")]], pp$t, pp$l, pp$b, pp$l)
# Get the y axis title from g2
index <- which(g2$layout$name == "ylab-l") # Which grob contains the y axis title?
ylab <- g2$grobs[[index]]                # Extract that grob
ylab <- hinvert_title_grob(ylab)         # Swap margins and fix justifications
# Put the transformed label on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
g1 <- gtable_add_grob(g1, ylab, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "ylab-r")
# Get the y axis from g2 (axis line, tick marks, and tick mark labels)
index <- which(g2$layout$name == "axis-l")  # Which grob
yaxis <- g2$grobs[[index]]                  # Extract the grob
# yaxis is a complex of grobs containing the axis line, the tick marks, and the tick mark labels.
# The relevant grobs are contained in axis$children:
#   axis$children[[1]] contains the axis line;
#   axis$children[[2]] contains the tick marks and tick mark labels.
# First, move the axis line to the left
yaxis$children[[1]]$x <- unit.c(unit(0, "npc"), unit(0, "npc"))
# Second, swap tick marks and tick mark labels
ticks <- yaxis$children[[2]]
ticks$widths <- rev(ticks$widths)
ticks$grobs <- rev(ticks$grobs)
# Third, move the tick marks
ticks$grobs[[1]]$x <- ticks$grobs[[1]]$x - unit(1, "npc") + unit(3, "pt")
# Fourth, swap margins and fix justifications for the tick mark labels
ticks$grobs[[2]] <- hinvert_title_grob(ticks$grobs[[2]])
# Fifth, put ticks back into yaxis
yaxis$children[[2]] <- ticks
# Put the transformed yaxis on the right side of g1
g1 <- gtable_add_cols(g1, g2$widths[g2$layout[index, ]$l], pp$r)
overlay.fluAs <- gtable_add_grob(g1, yaxis, pp$t, pp$r + 1, pp$b, pp$r + 1, clip = "off", name = "axis-r")
# Draw it
grid.newpage()
grid.draw(overlay.fluAs)
head(prevalence.nat.fluA)
prevalence.cdc.fluA <- read.csv('../DataSources/RegionalInfluenzaByType.csv')
head(prevalence.cdc.fluA)
prevalence.cdc.fluA <- with(prevalence.cdc.fluA, aggregate(100*PERCENT.A)~YEAR+WEEK, FUN=mean)
head(prevalence.cdc.fluA)
class(prevalence.cdc.fluA$PERCENT.A)
prevalence.cdc.fluA <- data.frame(YearWeek = with(prevalence.cdc.fluA, ifelse(WEEK < 10, paste(YEAR, WEEK, sep='-0'), paste(YEAR, WEEK, sep='-'))), Region = prevalence.cdc.fluA$REGION, TotalPatients = prevalence.cdc.fluA$TOTAL.SPECIMENS, TotalFluObservations = prevalence.cdc.fluA$TOTAL.A)
prevalence.cdc.fluA <- read.csv('../DataSources/RegionalInfluenzaByType.csv', header=TRUE, sep=',')
prevalence.cdc.fluA <- data.frame(YearWeek = with(prevalence.cdc.fluA, ifelse(WEEK < 10, paste(YEAR, WEEK, sep='-0'), paste(YEAR, WEEK, sep='-'))), Region = prevalence.cdc.fluA$REGION, TotalPatients = prevalence.cdc.fluA$TOTAL.SPECIMENS, TotalFluObservations = prevalence.cdc.fluA$TOTAL.A)
head(prevalence.cdc.fluA)
prevalence.cdc.fluA <- do.call(rbind, lapply(1:length(unique(prevalence.cdc.fluA$Region)), function(x) data.frame(YearWeek = prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'YearWeek'][2:(length(prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'YearWeek'])-1)], Region = unique(prevalence.cdc.fluA$Region)[x], TotalPatients = sapply(2:(length(prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'YearWeek'])-1), function(y) sum(prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'TotalPatients'][(y-1):(y+1)])), TotalFluObservations = sapply(2:(length(prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'YearWeek'])-1), function(y) sum(prevalence.cdc.fluA[prevalence.cdc.fluA$Region == unique(prevalence.cdc.fluA$Region)[x],'TotalFluObservations'][(y-1):(y+1)])))))
head(prevalence.cdc.fluA)
prevalence.cdc.fluA$Prevalence <- with(prevalence.cdc.fluA, TotalFluObservations/TotalPatients)
head(prevalence.nat.fluA)
head(prevalence.cdc.fluA)
prevalence.cdc.fluA <- with(prevalence.cdc.fluA, aggregate(Prevalence~YearWeek, FUN=mean))
prev.cdc.bfdx.fluA <- merge(prevalence.cdc.fluA, prevalence.nat.fluA, by='YearWeek')
heaD(prev.cdc.bfdx.fluA)
head(prev.cdc.bfdx.fluA)
with(prev.cdc.bfdx.fluA, cor(Prevalence.y, Prevalence.x))
lm(Prevalence.y~Prevalence.x, data=prev.cdc.bfdx.fluA)
attributes(lm(Prevalence.y~Prevalence.x, data=prev.cdc.bfdx.fluA))
summary(lm(Prevalence.y~Prevalence.x, data=prev.cdc.bfdx.fluA))
lm(Prevalence.y~Prevalence.x, data=prev.cdc.bfdx.fluA)$coeff
corAnnotation <- with(prev.cdc.bfdx.fluA, cor(Prevalence.y, Prevalence.x))
rSqAnnotation <- '0.985'
corAnnotation
corAnnotation <- as.character(round(with(prev.cdc.bfdx.fluA, cor(Prevalence.y, Prevalence.x)), 3))
corAnnotation
head(prev.cdc.bfdx.fluA)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar() + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(labels='percent') + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(labels='percent') + scale_x_discrete(breaks = dateBreaksAlt2, labels = dateLabelsAlt2) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
dateBreaksAlt2
dateLabelsAlt2
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(labels='percent') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(label='percent') + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5, color='black') + scale_fill_manual(values=c('dodgerblue'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5, color='black') + scale_fill_manual(values=c('dodgerblue','black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue','black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black')) + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date')
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=as.character(unique(prev.cdc.bfdx.fluA$YearWeek))[order(as.character(unique(prev.cdc.bfdx.fluA$YearWeek)))][seq(1, length(as.character(unique(prev.cdc.bfdx.fluA$YearWeek))), 8)])
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-40','2016-01','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Jul-2016','Oct-2016','Jan-2017'))
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-40','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017'))
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017'))
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-30', y=0.12, label=paste('R2 = ', rSqAnnotation, sep=''))
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.12, label=paste('R2 = ', rSqAnnotation, sep=''))
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.14, label=paste('R2 = ', rSqAnnotation, sep=''), size=2)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.14, label=paste('R2 = ', rSqAnnotation, sep=''), size=12)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.14, label=paste('R2 = ', rSqAnnotation, sep=''), size=8)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.15, label=paste('R2 = ', rSqAnnotation, sep=''), size=8)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.15, label=paste('R2 = ', rSqAnnotation, sep=''), size=6)  + annotate('text', x='2016-35', y=0.12, label=paste('Cor = ', corAnnotation, sep=''), size=6)
ggplot(prev.cdc.bfdx.fluA, aes(x=YearWeek, y=Prevalence.x, fill='CDC Flu A Prevalence')) + geom_bar(stat='identity') + geom_line(aes(x=YearWeek, y=Prevalence.y, group='FilmArray Flu A Detection', color='FilmArray Flu A Detection'), prev.cdc.bfdx.fluA, lwd=1.5) + scale_fill_manual(values=c('dodgerblue'), name='') + scale_color_manual(values=c('black'), name='') + scale_y_continuous(label=percent) + theme(plot.title=element_text(hjust=0.5),text=element_text(size=22, face='bold'), axis.text=element_text(size=22, color='black', face='bold'), axis.text.x=element_text(angle=90, hjust=1), legend.position='bottom', panel.background=element_rect(color='transparent', fill='white'), panel.grid=element_blank(), axis.ticks.x=element_blank()) + labs(y='FilmArray Detection, Flu Prevalence', x='Date') + scale_x_discrete(breaks=c('2015-41','2016-01','2016-14','2016-26','2016-40','2017-01'), labels=c('Oct-2015','Jan-2016','Mar-2016','Jul-2016','Oct-2016','Jan-2017')) + annotate('text', x='2016-35', y=0.15, label=paste('R2 = ', rSqAnnotation, sep=''), size=6)  + annotate('text', x='2016-35', y=0.14, label=paste('Cor = ', corAnnotation, sep=''), size=6)
